WEBVTT

00:00.500 --> 00:06.900
然后我们这期课继续 这期课的话 我们把那个上传图片 我把它讲了

00:07.400 --> 00:14.320
为什么讲上传图片呢 因为我们这边的话 就是这个首页标语 首页标语的话 你比如说你修改的话 用点修改

00:14.580 --> 00:19.700
修改的话 它其实不仅仅是标题描述 它有什么呢 还有就是你的这个这边

00:20.460 --> 00:22.000
涉及到一个图片的这个上传

00:22.780 --> 00:30.200
对不对 所以我们这边 我们把这个上传图片讲了 上传图片的话 在那个袁老师的那个漏的课程里面也有

00:30.820 --> 00:33.700
使用什么的啊 袁老师讲的是这个motor

00:34.420 --> 00:40.300
怎么讲的是这个啊 那我们这边他也是使用这个motor啊 直接使用这个motor来进行一个上传

00:41.060 --> 00:45.940
所以我们这边的话 先把这个项目停掉 停掉之后 然后我们这边我们来装一下

00:47.140 --> 00:50.900
这里的话就npm i 然后motor

00:51.660 --> 00:52.540
把这个装上

00:53.540 --> 00:59.420
好 装上之后 然后接下来的话 我们这边呢 我们就要设置一个新的这个路由 我们来看一下这个接口温挡

01:00.380 --> 01:01.340
你到这边来看一下

01:02.180 --> 01:06.780
把这个接口温挡弄一眼 这边的话它是什么 是api

01:07.500 --> 01:09.620
upload 然后是post的请求

01:10.420 --> 01:15.820
看到没有 到时候的话 然后这样这边content type 这边那就是formdata

01:16.580 --> 01:18.300
然后加这边会写在这个token

01:18.900 --> 01:22.260
然后body body的话里面就是什么呢 就是一张这个图片

01:22.980 --> 01:28.700
啊 就是上图片 好大家最后返回的数据 返回的数据code0 message没有 然后这个data

01:29.180 --> 01:32.660
data就是你这个上传到服务器的这个路径

01:33.940 --> 01:36.500
看到没有 啊 但这个名字的话是处理过的

01:37.220 --> 01:44.460
啊 名字的话不是说你比如你上传一张图片 叫做一点节匹计 啊 上传到服务器就叫一点节匹计啊 不是

01:44.780 --> 01:50.140
一般的话服务器会针对你的这个图 就是你上传的这个文件 名字的话会做一个二次处理

01:50.620 --> 01:52.580
加上一个比如时间戳啊之类的

01:53.220 --> 01:57.860
不然的话 你比如你上传一个一点节匹计 别人也上传一个这个一点节匹计

01:58.340 --> 02:06.100
就重明了 对不对 服务器这边一般都是会做处理的啊 这个接口的话就是这个样子

02:06.780 --> 02:11.060
那我们这边回到我们这个代码这边 那我们这边的话就新建一个

02:12.100 --> 02:14.060
新建一个upload.js

02:15.420 --> 02:21.820
啊 这边upload.js啊 然后接下来我们这边拿一个模板过来

02:22.820 --> 02:23.820
ctrc

02:24.780 --> 02:30.980
ctrv啊 这个就不要了 对吧 好 然后既然这边这边到底是什么呢 这边就应该是post

02:32.180 --> 02:40.740
对不对 这边就应该是post啊 这个先不要 好 然后这是我们的这个上传图片 上传图片的接口 然后完事了之后就去那个

02:41.900 --> 02:44.740
app.js啊 这边是不是引入录谣

02:45.660 --> 02:49.100
对不对 就一样的啊 就一样的 让我直接复制

02:50.100 --> 02:54.820
好 这里 这里的话就应该是upload

02:55.660 --> 02:59.340
然后这里的话也是upload.souter

03:00.300 --> 03:02.460
好 完了之后 然后接下来这里

03:03.940 --> 03:04.700
配路由这里

03:05.900 --> 03:10.860
好 这里的话就应该是upload.souter 对应的这边就是api

03:12.420 --> 03:12.820
upload

03:13.900 --> 03:18.500
对吧 好 OK 好 然后接下来这个地方 这个地方该怎么写

03:19.340 --> 03:22.540
这个地方的话 我们这里首先的话 我们需要

03:24.300 --> 03:25.580
在我们的这个youtube

03:26.300 --> 03:33.540
youtube室里面这个tool里面啊 我们这边的话 得首先的话来写一下 我们这个上传的一些东西啊 我们这边我们来看一下

03:35.140 --> 03:42.740
好 我们这边的话 首先把那个motor 我们把它引入啊 这边const一个motor等于一个

03:43.420 --> 03:47.540
require require motor

03:48.540 --> 03:54.660
OK 先把引入 然后引入之后 然后接下来我们这边我们来看一下 看文档啊 一定要学会去看文档

03:55.180 --> 03:59.340
文档的话 在它的下面 它是写的有这个使用的这个方法的

04:00.220 --> 04:07.860
可不可以啊 这边的话 你这里的话 引入这个motor motor 然后接下来这边的话 是接收一个对象 对象的话 它这边设置了什么

04:08.300 --> 04:09.740
就设置了你存储的这个路界

04:10.740 --> 04:12.500
对不对 好 然后接下来啊 这边

04:13.500 --> 04:19.380
整个 然后接收一下它的返回值 接收了之后 然后加这边upload的点这个single

04:20.020 --> 04:25.420
啊 这里的话就是上传图片 上传了之后 然后下这边的话是做上传之后的这个处理

04:26.060 --> 04:29.900
当我们这边的话 可以进行一个更详细的设置 他在下面写的有

04:30.900 --> 04:31.900
我看是在哪个位置

04:32.900 --> 04:34.460
在下面 这里 这里

04:35.540 --> 04:38.860
怎么样 这边你可以进行一个更详细的设置 这边这个motor

04:39.220 --> 04:43.980
传入一个对象 啊 这个对象的话 它刚才的话是什么 是那个deast

04:44.420 --> 04:51.660
就刚刚最开始的时候 是不是是deast deast 然后指定你上传的目录啊 对不对 但是你看它这边的话就是还可以做

04:52.180 --> 04:55.100
干嘛呢 还可以就是这边storage

04:55.740 --> 04:58.940
指定你的这个存储引擎 是这个storage

04:59.460 --> 05:02.420
好 大家这个storage就是上面说定义的

05:03.220 --> 05:07.020
可不可以啊 好 那我们这边我们就用这种 把这个复制过来

05:09.130 --> 05:09.970
好 把他拿过来

05:11.370 --> 05:16.250
拿过来之后 然后这样我们要稍微做一些修改 首先的话这个constor storage

05:16.650 --> 05:19.850
这个是什么呢 这个是设置上传文件的引擎

05:22.340 --> 05:22.860
设置

05:25.980 --> 05:35.140
设置上传文件的引擎 那回头的话你这边motor的时候你指定引擎 是不是就是你这边设置了这个引擎

05:35.940 --> 05:39.340
对不对 好 然后接下来这边两个东西 一个是这个

05:40.060 --> 05:43.900
distination 这个是你文件存储的这个位置

05:45.660 --> 05:54.020
文件存储的位置 就是人家用户是不是上传文件 上传了你总得指定就是你上传上来存在哪里

05:55.060 --> 06:00.340
对不对 好 那我们这边我们存在哪里呢 我们这边的话 我们这里的话说public

06:01.380 --> 06:03.980
下面有个static static 是不是有个这个upload

06:04.980 --> 06:10.340
所以就存在这个地方 对不对 说我们这边来我们来指定一下 这边的话就是下滑线

06:12.260 --> 06:16.460
下滑线下滑线啊 d i r 内幕 加上一个

06:17.140 --> 06:21.660
这里斜杠 然后点点上一集的这个public

06:22.660 --> 06:25.860
下面的这个static 下面的什么呢

06:26.500 --> 06:27.220
upnodes

06:28.220 --> 06:30.220
看没有啊 这是的这个

06:31.260 --> 06:38.020
指定文件的这个存储位置 好 然后接下来下一步 下一步的话这里 这里的话是就是

06:38.860 --> 06:48.920
上传 上传到服务器的文件 然后文件名

06:49.840 --> 06:53.280
文件名要做单独处理

06:54.160 --> 06:55.960
啊 这个的话我刚才是不是已经说过了

06:56.880 --> 07:03.680
对不对 你比如说用户的这个文件他就叫做一点节匹计 那这个用户上传他的图片叫一点节匹计

07:04.040 --> 07:09.560
另外一个用户也叫一点节匹计 你这样子的话 你是不是多个用户上传是不是会出问题

07:10.360 --> 07:12.600
对不对 所以我们这边的话一般会对这个名字

07:13.240 --> 07:14.560
进行一个处理

07:15.520 --> 07:22.360
啊 处理的话我们怎么处理呢 很简单 就是加上一个时间戳 然后如果不够的话再加上一个什么呢 再加上一个

07:22.640 --> 07:23.040
随机数

07:24.120 --> 07:24.560
就可以了

07:25.440 --> 07:27.680
ok 啊 说说我们这边的话我们这样子

07:29.320 --> 07:33.240
我们这样子来做 好 他首先的话通过这个通过这个

07:34.480 --> 07:35.880
file 他这边是不是有个file

07:36.920 --> 07:41.440
对不对 通过file 然后这个file的话他有一个original name

07:42.320 --> 07:46.080
可以获取到他这个原始的这个名字 我们这边我给大家来看一下吧

07:46.840 --> 07:50.360
我们这样子 我们把这个注释掉 注释掉之后给大家看一下

07:51.120 --> 07:51.640
console

07:52.600 --> 07:55.320
点log 我们把这个file

07:56.200 --> 07:59.240
file的话他有一个这个original 就这个就这个

08:00.680 --> 08:04.880
可不可以啊 有个这个名字 或者我把这个整个这个file我把打印出来

08:05.760 --> 08:07.880
好吧 打印出来大家可以看一下

08:09.000 --> 08:16.520
ok 好 那这个引擎我们就先这样子 还没写完哈 这边的话这个要进行处理的 名字要进行处理 我们这边还没写完

08:17.160 --> 08:20.760
好 然后接下来下面 下面的话这边motor

08:21.760 --> 08:26.920
这里这个对象 对象的话 我们这边除了指定 指定我们的这个引擎以外

08:27.560 --> 08:31.240
我们这边还指定什么呢 还指定一个这个文件大小的限制

08:31.800 --> 08:34.840
这个他也是可以指定的 你在这个文档里面你看一下

08:35.760 --> 08:40.800
他是有的 看到没有 limits limits里面你可以指定比如这个

08:42.040 --> 08:45.920
file的size 这个file值值的这个最大长度

08:46.640 --> 08:50.240
然后还有一个 我记得有个file size在哪

08:52.000 --> 08:52.960
file size 这里

08:54.000 --> 09:00.800
可不可以啊file size 就是你文件的最大长度啊 然后还有就是这个files 文件的最大数量

09:02.120 --> 09:08.360
怎么样啊 说我们这边我们可以指定一下 这边的话limits他对应的只是一个对象

09:09.160 --> 09:10.480
对象里面然后有这个

09:12.400 --> 09:15.680
file size 你不要敲错了哈file size 我这边呢就

09:16.080 --> 09:18.640
是两照 两照的话这里就是

09:19.720 --> 09:25.960
这里就是二 然后一二三四五六 ok 这就是两照

09:27.640 --> 09:30.240
然后files files 这里就是一

09:31.680 --> 09:40.760
然后回头的话 你把这个把他导出出去 我们这边呢就是model 点expose 点这个uploading

09:42.480 --> 09:43.600
uploading

09:44.560 --> 09:48.320
把他导出出去 ok 这里怎么报错了呢

09:49.760 --> 09:58.240
这里忘记打冒后了 ok 把他导出出去 好 然后我们这块就差不多了 除了这里啊 这里文件名还没有做处理

09:58.880 --> 10:01.840
好 然后这一块写完之后 然后接下来回到我们这边

10:02.800 --> 10:08.800
这边的话 你首先的话就需要把刚才我们导出的那个uploading 你先把它引入

10:09.600 --> 10:12.080
大家他这边可以自动引入 你这边直接用就可以了

10:13.040 --> 10:20.480
这边就怎么来做呢 这边的话就直接uploading okuploading 然后点这个single

10:21.920 --> 10:31.200
然后接下来的话 这边file 你注意这个voe他这边的话 我给大家看一下啊 这个怎么去找

10:32.800 --> 10:36.960
就是我们这边的话是不是用的是voe里面的这个上传空间

10:37.760 --> 10:40.960
对不对 voe的上传空间 你这边的话 你把它展开 你把它看一下

10:41.440 --> 10:43.200
他这边的话要取他的这个内幕值

10:45.680 --> 10:51.730
我这边过来一下 然后这里拿到

10:53.330 --> 10:57.010
嗯 这里看到没有 这里 你看他的内幕值是不是file

10:57.730 --> 11:01.330
这里的话要写你那个上传空间的这个内幕值

11:02.130 --> 11:06.770
明白吧 要写这个内幕值啊 说说我们这边的话就写了什么呢 single

11:07.330 --> 11:12.050
啊 因为我们是上传这个单个文件 大家这边的话就是你上传空间的内幕值

11:12.290 --> 11:15.650
我把它写一下啊 就是single方法里面

11:16.930 --> 11:23.570
single方法里面书写什么呢 上传空间

11:24.610 --> 11:26.530
上传空间

11:27.890 --> 11:30.050
空间的内幕值

11:30.850 --> 11:35.890
啊 所以为什么我这边写一个file 因为你这边使用了这个voe 我们这边使用的是

11:35.970 --> 11:39.970
voe里面的这个上传空间 对吧 他最终的话渲染在这个页面上

11:40.130 --> 11:42.610
他的这个上传空间的内幕值为file

11:43.490 --> 11:46.290
ok 好 然后接下来的话 这边继续

11:47.570 --> 11:52.130
好 这边他就上传 上传之后 然后接下来的话 这边有一个这个回调函数

11:54.560 --> 11:56.800
啊 这里的话会有个回调函数req

11:57.360 --> 12:00.000
res 然后接下来的话 这边function

12:02.460 --> 12:03.340
然后arrow

12:05.020 --> 12:07.660
arrow 也就是说你如果上传出错

12:08.540 --> 12:09.100
怎么来做

12:10.140 --> 12:13.020
对吧 你如果上传出错 好 我们这边我们来看一下

12:13.740 --> 12:16.620
这里的话 其实是什么呢 是官方文档给我们提供了的

12:17.580 --> 12:20.380
我们来到这边啊 看到下面这里

12:21.740 --> 12:24.060
看到没有 错误处理机制

12:24.940 --> 12:30.620
当遇到一个错误 motor 会把这个错误发送给express

12:31.340 --> 12:33.020
啊 这个就是我们之前最早说的

12:33.580 --> 12:36.780
你那个express里面如果发生错误

12:37.260 --> 12:39.020
发生错误的话 他会自动进哪里

12:39.580 --> 12:41.260
自动会进这个位置

12:42.220 --> 12:45.660
对不对 但我们有些时候我们想干嘛呢 我们想捕捉

12:46.220 --> 12:51.900
就是这个motor 发出的这个错误 然后调用我们自己的中间间这个程序

12:52.460 --> 12:55.900
也就是说我们当时写那个错误处理类的时候 我们就说过

12:56.300 --> 12:58.540
啊 我们说了 我们不想让他就直接去

12:58.940 --> 13:03.900
跑到那个就是他统一的express处理的那个地方 而是干嘛呢 而是我们捕捉到

13:04.300 --> 13:07.420
捕捉到之后 然后抛出我们自定义的错误

13:08.460 --> 13:10.220
对不对 抛出我们自定义的错误

13:10.700 --> 13:11.900
好 你看他这边是怎么写的

13:13.020 --> 13:16.780
你看他这边 这边的话他是不是就是e符这个error

13:17.340 --> 13:20.220
instance这个motor motor error

13:21.500 --> 13:23.180
是不是说明就是有问题

13:23.900 --> 13:27.180
对不对 大家这边l是e符啊 就其他类型的error

13:27.660 --> 13:29.740
啊 大家否则的话 这边一切都好

13:30.620 --> 13:33.980
是吧 好 那我们这边呢 我们就干嘛呢 我们这边就直接来呗

13:35.180 --> 13:37.660
来到我们这里 我们这边呢 就是e符

13:38.620 --> 13:40.300
e符你这个error

13:40.700 --> 13:42.220
然后instance of

13:43.020 --> 13:43.820
这个motor

13:45.020 --> 13:47.580
motor点这个motor error

13:48.700 --> 13:52.140
那说明什么 说明是不是上传文件出错

13:52.700 --> 13:56.060
对不对 上传文件出错 然后既然我们这边就要抛出我们自己的

13:56.540 --> 14:01.500
错误 我们这边就new一个什么呢 new一个upload error

14:02.620 --> 14:06.220
然后里面的话就写一下这个上传文件失败

14:08.220 --> 14:09.820
上传文件

14:11.920 --> 14:13.360
文件失败

14:13.920 --> 14:18.960
那这个上传文件失败 大概立了原因就是什么呢 就是他的那个比如说

14:20.160 --> 14:23.440
大小超粗了 对吧 所以我们这边就写一个

14:23.920 --> 14:24.240
请

14:25.520 --> 14:26.240
检查

14:27.200 --> 14:28.400
文件的

14:29.440 --> 14:29.840
大小

14:30.640 --> 14:31.600
控制

14:32.480 --> 14:34.000
在两兆

14:34.960 --> 14:35.440
以内

14:36.640 --> 14:38.960
对吧 啊 这边是一个new error

14:39.200 --> 14:40.000
这是你注意

14:41.360 --> 14:44.160
这里的话 你不能干嘛 你不能直接在这里抛出

14:44.960 --> 14:52.320
你这里抛出的话 它是 这边的话是拿不到的 我们这边的话是应该干嘛呢 这边的话是应该是直接next

14:54.000 --> 14:55.200
怎么样 直接让他走

14:55.920 --> 15:00.160
他把这个错误把它放进去 应该是这个样子 next

15:00.800 --> 15:02.960
好 然后接下来这个是有错误的情况

15:03.280 --> 15:05.920
for the else

15:06.640 --> 15:10.400
for the else 这里就什么呢 这里的话是不是就是上传成功

15:11.120 --> 15:14.800
对吧 上传成功的话 然后我们这边呢就const了一个

15:15.360 --> 15:16.400
rsp

15:16.800 --> 15:19.920
啊 这边呢 它是一个对象 对象里面的话 我们就来写

15:20.480 --> 15:25.120
啊 这个message对应的是什么呢 对应的是上传文件

15:26.000 --> 15:26.400
成功

15:27.440 --> 15:29.600
对吧 好 然后接下来的话这里

15:32.880 --> 15:35.120
好 然后现在还有个什么呢 还有一个这个pass

15:36.240 --> 15:38.560
pass对应的就是什么呢 pass对应的就是

15:39.120 --> 15:39.920
static

15:40.800 --> 15:43.600
下面的这个upload

15:44.080 --> 15:48.000
然后再加上一个req.file

15:48.960 --> 15:50.160
点file name

15:51.120 --> 15:55.840
啊 就是你上传成功之后 通过这个req.file.file name

15:56.000 --> 16:00.160
可以拿到这个内幕 当我们现在这个内幕的话 我们在这边是不是还没有做处理

16:00.720 --> 16:03.040
对 它拿到的是做了处理后的这个内幕

16:03.440 --> 16:03.680
啊

16:04.640 --> 16:11.360
ok 好 大家完事之后 然后向这个客户端返回res.send

16:12.080 --> 16:16.800
啊 发送什么呢 这边for format response

16:18.640 --> 16:19.680
啊 这里就是0

16:20.560 --> 16:22.880
然后一个空置串

16:23.520 --> 16:24.720
好 然后加这边啊

16:26.000 --> 16:26.480
rsp

16:27.120 --> 16:28.080
然后点pass

16:30.530 --> 16:31.810
对吧 点pass

16:32.530 --> 16:34.770
那我们这边的话 这个对象的话

16:35.970 --> 16:38.210
没有什么必要 是吧 我们这边就直接

16:39.730 --> 16:40.610
直接这样子

16:41.330 --> 16:42.450
这样子const

16:43.330 --> 16:44.610
const一个pass

16:45.970 --> 16:46.530
等于

16:47.650 --> 16:48.050
这一块

16:48.850 --> 16:49.490
是不是可以了

16:50.050 --> 16:51.730
我之前写的时候 我还组装了一个对象

16:52.210 --> 16:54.130
现在回头再看的时候 这个对象没有什么必要

16:54.850 --> 16:55.170
是吧

16:55.730 --> 16:56.850
啊 这边就直接pass

16:57.570 --> 16:58.370
是不是就ok了

16:59.170 --> 16:59.570
对不对

17:00.050 --> 17:02.130
好 这个就是我们整个这个上传文件

17:02.370 --> 17:03.650
好 那我们这边我们来看一下

17:04.050 --> 17:05.490
我们这边的话 先把这个项目

17:06.770 --> 17:07.810
好 先跑起来

17:08.610 --> 17:09.330
全部保存

17:10.290 --> 17:13.730
保存了之后 然后既然我们这边的话 把它跑起来走

17:15.010 --> 17:16.050
诶 放错了 是吧

17:16.610 --> 17:17.970
放错了 我们这边我们来看一下

17:19.250 --> 17:19.890
放到什么错

17:22.430 --> 17:22.670
呃

17:24.670 --> 17:26.990
大概率又是那个中间线没有导出

17:27.870 --> 17:28.510
啊 果然是

17:29.390 --> 17:30.910
果然是 这边是不是没有导出啊

17:31.630 --> 17:33.070
对了 这边是怎么写的呢

17:33.550 --> 17:35.230
model.export

17:35.870 --> 17:37.870
等于一个这个rotor

17:38.190 --> 17:38.990
是这样子的 是吧

17:39.630 --> 17:40.430
啊 保存

17:40.670 --> 17:42.110
保存了之后 然后这边再来看

17:43.710 --> 17:46.430
数据也启动这个椅子怎么回事

17:47.150 --> 17:48.350
椅子怎么变成这样子了

17:48.830 --> 17:50.350
好 这边再来一次呢

17:50.830 --> 17:51.870
它有些时候是这样子的

17:52.750 --> 17:53.550
诶 还是这样子

17:53.790 --> 17:54.430
啊 不管它

17:54.750 --> 17:56.910
啊 这里吧 反正启动是启动ok的

17:57.470 --> 18:00.030
好 启动ok之后 然后接下来的话 我这边

18:00.750 --> 18:03.070
post面 我来进行一个测试

18:03.550 --> 18:05.470
这边的话 我们的这个接口是什么来着

18:06.510 --> 18:08.830
接口是api upload

18:09.310 --> 18:10.510
是吧 api

18:11.630 --> 18:13.310
appload

18:13.470 --> 18:14.510
然后这边是什么

18:14.670 --> 18:15.630
这边是post

18:16.670 --> 18:17.070
对吧

18:17.470 --> 18:18.830
好 然后接下来这边body

18:18.830 --> 18:21.070
body的话 这边要选这个formdata

18:21.710 --> 18:25.390
formdata 然后接下来的话 我们这边的话 要找一个这个文件

18:26.590 --> 18:28.510
我看一下啊 我们这边的话

18:29.230 --> 18:30.750
我看一下这个post面

18:31.070 --> 18:32.910
如何这个添加一个文件

18:36.620 --> 18:38.780
啊 这里的话 它有一个text

18:39.180 --> 18:40.700
看到没有 这里的话可以选

18:41.340 --> 18:42.220
你就选择file

18:42.860 --> 18:44.700
啊 选择file 然后接下来这边就可以

18:44.940 --> 18:46.300
选择这个上传文件了

18:46.460 --> 18:47.500
好 我们来找一张啊

18:48.700 --> 18:49.740
找一张这个文件

18:50.300 --> 18:51.180
这边图片

18:51.980 --> 18:52.620
找一张

18:54.540 --> 18:55.500
找一张什么呢

18:55.820 --> 18:56.300
就这个吧

18:56.780 --> 18:58.060
就这个打开

18:58.460 --> 19:00.300
啊 打开之后 然后在这边走

19:01.260 --> 19:03.660
好 这边呢 是unknown error

19:03.660 --> 19:05.020
啊 这边呢 报了一个错

19:05.180 --> 19:06.300
那我们这边 我们来看一下

19:08.060 --> 19:09.180
这里报了什么错

19:09.660 --> 19:11.100
syntax error

19:11.980 --> 19:13.100
语法错误

19:14.860 --> 19:16.780
语法错误 在

19:17.660 --> 19:20.140
app.js77行

19:21.420 --> 19:22.380
在这个位置

19:24.610 --> 19:28.450
这个位置 它抛出一个语法错误

19:28.450 --> 19:29.730
然后我们这边再来看啊

19:29.890 --> 19:30.530
再来看

19:31.810 --> 19:36.880
嗯upload500

19:38.320 --> 19:40.640
然后这里 我看一看

19:41.760 --> 19:44.640
这里的话 我们这个API这边

19:46.910 --> 19:49.710
uploadrotorAPI

19:50.910 --> 19:52.030
然后upload

19:53.710 --> 19:56.110
然后这里的话uploadrotor

19:56.910 --> 19:57.950
这些什么都是对的

19:58.990 --> 19:59.470
对不对

20:00.030 --> 20:00.910
这里都是对的

20:01.230 --> 20:02.030
对了的话

20:02.030 --> 20:04.350
然后接下来这里的话应该是来到这边

20:04.910 --> 20:06.110
我们一步一步来排嘛

20:07.390 --> 20:09.310
这里的话 首先是应该是来到这边

20:11.260 --> 20:11.660
保存

20:12.700 --> 20:14.780
保存了之后 然后接下来 把这边再来

20:16.540 --> 20:17.260
这边再来

20:17.660 --> 20:18.460
然后发送

20:19.180 --> 20:21.260
啊 发送之后 让我们这边过来看一眼

20:23.390 --> 20:24.990
嗯 这边真的是报错是吧

20:26.030 --> 20:27.790
un-expect-token

20:29.790 --> 20:30.350
token

20:31.470 --> 20:32.110
我看一看

20:33.630 --> 20:34.830
这里的话

20:35.790 --> 20:38.190
我们的这个token是有的呀

20:39.150 --> 20:40.350
哦 这里

20:41.550 --> 20:43.550
这里的话这个content type

20:44.510 --> 20:45.230
可不可以啊

20:45.230 --> 20:46.990
这里呢 我们之前设置的是

20:47.150 --> 20:48.670
polycation json 是吧

20:48.670 --> 20:49.870
把这个把他去除掉

20:50.430 --> 20:52.030
去除掉之后 然后加这边走

20:52.350 --> 20:53.470
好 这边卡住了

20:53.470 --> 20:54.590
卡住了之后这边来看

20:54.830 --> 20:56.030
这边呢 是不是 a

20:56.590 --> 20:57.550
对不对 过来了

20:57.550 --> 20:58.190
OK

20:58.190 --> 21:00.430
好 过来之后 然后加我们这边再来

21:01.070 --> 21:02.590
一步一步来 保存

21:02.830 --> 21:03.310
保存

21:04.670 --> 21:06.990
好 保存之后 然后接下来的话 我们这边

21:08.510 --> 21:08.830
走

21:09.870 --> 21:13.470
啊 这边上传失败 控制在413里面

21:14.030 --> 21:16.030
我们这边一点点来看 这边的话

21:16.670 --> 21:18.110
因为我们这个文件不大呀

21:19.950 --> 21:21.550
我们这个文件不大呀

21:21.550 --> 21:23.070
我专门选了一个小的文件

21:24.830 --> 21:26.430
这里的话 我们选一个比如这个

21:26.430 --> 21:27.470
这个只有11kb

21:28.670 --> 21:28.990
走

21:29.710 --> 21:29.950
走

21:31.150 --> 21:32.190
啊 这里没对啊

21:32.750 --> 21:33.630
这里不是没对

21:34.190 --> 21:35.870
对 这里好像抛错误了

21:36.910 --> 21:38.270
这里的话 我们先来看一下

21:39.070 --> 21:41.390
upload 我们又上传过来

21:43.070 --> 21:44.110
uploading

21:44.750 --> 21:45.470
sync

21:46.430 --> 21:46.830
file

21:47.950 --> 21:48.910
我们看一下这边

21:50.590 --> 21:51.470
这边的话

21:52.830 --> 21:53.230
呃

21:56.020 --> 21:58.020
好 这里刚才调试了一下啊

21:58.020 --> 21:59.220
这里的话是这个样子的

21:59.780 --> 22:01.140
就用我们这边的话

22:01.700 --> 22:02.820
我们这边upload

22:02.820 --> 22:04.820
这边upload 我们写的是file

22:05.460 --> 22:07.220
对不对file的话 这边的话是什么呢

22:07.220 --> 22:08.740
是上传空间的内幕字

22:08.980 --> 22:10.980
然后我们这边的话忘记写这个key了

22:11.220 --> 22:13.460
把这个key把它搞上就可以了

22:13.460 --> 22:14.980
这边你就写上这个file

22:15.700 --> 22:16.420
写了这个之后

22:17.300 --> 22:17.620
走

22:18.180 --> 22:18.500
你看

22:19.140 --> 22:20.260
这边upload是不是就卡住了

22:20.660 --> 22:21.860
卡住了你回头再看这边

22:21.860 --> 22:22.820
哎 是不是有了

22:23.620 --> 22:24.580
对不对 有了之后

22:24.580 --> 22:26.180
然后接下这个的话在哪打印的

22:27.060 --> 22:28.580
这个的话就是在

22:29.620 --> 22:30.020
呃

22:31.060 --> 22:31.620
这个位置

22:32.420 --> 22:33.460
是不是这个位置打印的

22:34.020 --> 22:34.580
对不对

22:34.580 --> 22:35.380
所以我们现在的话

22:35.380 --> 22:36.740
我们要做的事情就是什么呢

22:36.740 --> 22:38.420
我们要针对这个名字

22:38.420 --> 22:42.100
你现在的话这个叫做totono2.png

22:42.100 --> 22:43.460
我们要针对这个名字

22:43.460 --> 22:44.900
我们要做一个这个处理

22:45.300 --> 22:45.700
啊

22:45.940 --> 22:47.380
那我们这边我就直接处理了啊

22:47.380 --> 22:49.140
我这边已经打印出来给大家看了

22:49.140 --> 22:50.020
大家也看到

22:50.020 --> 22:50.980
它是一个对象

22:50.980 --> 22:52.340
对象里面有哪些件

22:52.340 --> 22:53.220
是不是都看到了

22:53.780 --> 22:54.900
好 那接下来我们这边

22:54.900 --> 22:57.540
我们首先获取文件名

23:00.190 --> 23:00.990
啊 我们这边呢

23:00.990 --> 23:02.270
首先获取文件名

23:05.140 --> 23:07.460
获取文件名

23:08.100 --> 23:09.860
然后这里的话就是const

23:09.860 --> 23:11.540
一个basename

23:12.660 --> 23:13.540
等于一个什么呢

23:13.540 --> 23:14.580
等于一个pass

23:15.540 --> 23:17.700
点这个basename

23:17.700 --> 23:19.460
这边它应该就把这个pass

23:19.460 --> 23:20.660
哎 它还没够引入

23:21.620 --> 23:22.100
好

23:22.100 --> 23:22.500
然后

23:23.300 --> 23:24.980
这边basename

23:24.980 --> 23:27.300
然后这里的话是file

23:29.300 --> 23:30.580
file点这个

23:31.220 --> 23:33.540
origin original name

23:33.700 --> 23:35.540
origin name 是不是它原本的名字

23:36.340 --> 23:36.980
对不对

23:36.980 --> 23:38.660
好 然后接下来的话这边

23:39.700 --> 23:41.380
它的这个排除什么呢

23:41.380 --> 23:42.580
排除它的后维

23:42.580 --> 23:43.620
pass点这个

23:43.620 --> 23:45.860
它有一个e chart name

23:46.580 --> 23:48.180
这个pass是那个

23:49.060 --> 23:50.980
是那个load.js里面的那个模块

23:51.460 --> 23:52.580
大家还记不记得

23:52.580 --> 23:54.340
啊 这边它没够引入吗

23:54.340 --> 23:56.420
没够引入我们自己引入一下

23:56.420 --> 23:57.620
这边肯定要引入

23:58.180 --> 23:59.780
等于一个require

24:01.220 --> 24:02.420
这边的话pass

24:03.140 --> 24:06.020
啊 这个是load里面原生的这个模块

24:06.020 --> 24:06.740
pass模块

24:07.860 --> 24:10.420
好 这个关于这个方法我就不多说了

24:11.140 --> 24:12.660
这个pass

24:12.660 --> 24:14.420
它的什么basename呀

24:14.420 --> 24:15.620
然后接下来这个e chart name

24:15.620 --> 24:16.980
这个我就不多说了

24:16.980 --> 24:18.980
这个的话都是之前袁老师

24:18.980 --> 24:20.100
讲过的

24:20.100 --> 24:20.980
对不对

24:20.980 --> 24:22.900
然后这边就是要获取它的

24:22.900 --> 24:24.020
这个基本的名字

24:24.820 --> 24:25.700
然后排除什么呢

24:25.700 --> 24:27.300
排除它的这个后维

24:28.100 --> 24:28.420
file

24:29.220 --> 24:31.220
点origin name

24:31.300 --> 24:32.820
这个的话就获取到哪一块

24:32.820 --> 24:34.900
是获取到它这个total node2

24:35.460 --> 24:36.660
是不获取到它的文件名

24:37.380 --> 24:39.140
然后接下来再获取什么呢

24:39.140 --> 24:41.060
再获取它的这个后维名

24:42.500 --> 24:43.300
后维名

24:43.300 --> 24:44.500
啊 这边const

24:44.500 --> 24:47.060
const的一个e chart name

24:47.700 --> 24:48.820
它就等于一个

24:49.540 --> 24:50.500
是不是就是等于这一块

24:52.580 --> 24:52.900
对不对

24:53.540 --> 24:54.180
就是这一块

24:55.060 --> 24:55.780
OK

24:55.780 --> 24:57.380
好 然后文件名和后维名

24:58.180 --> 24:59.300
都搞定了

24:59.300 --> 24:59.940
搞定之后

24:59.940 --> 25:00.900
然后接下来我们这边

25:00.980 --> 25:02.900
我们要构建这个新的名字

25:04.100 --> 25:06.580
构建新的名字

25:07.460 --> 25:08.580
为什么要构建新的名字

25:08.580 --> 25:10.020
我刚才已经讲过了

25:10.020 --> 25:10.740
对吧

25:10.740 --> 25:12.660
服务器这边要做二次处理

25:12.660 --> 25:14.020
所以我们这边呢就const

25:16.020 --> 25:17.460
const一个什么呢

25:17.460 --> 25:18.180
new name

25:19.780 --> 25:20.740
它就等于什么呢

25:20.740 --> 25:22.020
等于最基本的

25:22.500 --> 25:23.220
best name

25:23.940 --> 25:24.980
加上一个

25:24.980 --> 25:26.100
我加上一个时间戳

25:26.660 --> 25:27.700
new date

25:28.420 --> 25:30.580
然后点get time

25:31.620 --> 25:32.500
是不是时间戳

25:32.500 --> 25:33.620
当前的时间戳

25:33.620 --> 25:34.580
当前的时间戳

25:34.580 --> 25:36.260
然后这样如果你觉得还不够

25:36.260 --> 25:37.940
我们这边再给它加一个随机数

25:38.740 --> 25:40.340
mass.throw

25:41.060 --> 25:42.340
然后接下来这边的话

25:42.340 --> 25:44.500
mass.rounder

25:46.180 --> 25:46.900
成一个

25:47.540 --> 25:49.700
我这边是成一个9000

25:49.700 --> 25:50.660
然后加一个

25:51.460 --> 25:51.860
1000

25:52.580 --> 25:53.140
什么意思啊

25:54.020 --> 25:54.660
就是从

25:57.380 --> 25:58.500
这个1000

25:58.900 --> 25:59.060
到

26:00.020 --> 26:01.060
9999

26:01.540 --> 26:02.180
的随机数

26:03.620 --> 26:05.540
然后接下来最后再拼接上什么

26:05.540 --> 26:07.460
再拼接上你的这个依叉T

26:07.460 --> 26:07.860
name

26:08.820 --> 26:09.220
ok

26:09.220 --> 26:10.660
这就是我们的新名字

26:10.660 --> 26:10.980
好

26:10.980 --> 26:12.100
新名字完事了之后

26:12.100 --> 26:12.820
然后再把这个

26:13.540 --> 26:14.580
把它打开

26:14.580 --> 26:14.820
好

26:14.820 --> 26:16.260
然后加这边后面这边

26:16.260 --> 26:17.940
这边的话就直接传什么

26:17.940 --> 26:19.700
就传这个new name

26:20.980 --> 26:21.540
就ok了

26:22.260 --> 26:22.900
可不可以啊

26:22.900 --> 26:23.220
好

26:23.220 --> 26:24.180
格式换一下

26:24.180 --> 26:24.820
就搞定了

26:25.540 --> 26:26.260
可不可以啊

26:26.260 --> 26:27.460
整个就搞定了

26:27.460 --> 26:28.260
我们保存一下

26:28.260 --> 26:30.340
我们来看我们的这个上传能不能成功

26:31.220 --> 26:31.620
现在的话

26:31.780 --> 26:33.220
这个upload是空的

26:33.220 --> 26:33.940
是吧

26:33.940 --> 26:34.420
好

26:34.420 --> 26:35.460
我们这边让我们

26:35.460 --> 26:36.740
胜的

26:36.740 --> 26:37.620
好

26:37.620 --> 26:38.500
你看这边

26:38.500 --> 26:39.540
首先名字

26:39.540 --> 26:40.340
有没有问题

26:40.340 --> 26:42.340
名字什么没有问题

26:42.340 --> 26:43.780
名字没问题

26:43.780 --> 26:44.740
这边少了一个什么

26:44.740 --> 26:45.940
这不少了一个鞋杠

26:45.940 --> 26:47.380
对不对

26:47.380 --> 26:48.500
这边少了一个鞋杠

26:48.500 --> 26:49.700
我们这边我们来看一下

26:49.700 --> 26:51.380
你看这边

26:51.380 --> 26:52.580
图片是不是上传上去了

26:52.580 --> 26:54.500
这个龙猫的这个图片

26:54.500 --> 26:56.180
是不是就上传上去了

26:56.180 --> 26:57.300
对不对

26:57.300 --> 26:58.740
统一的这个上传接口

26:58.740 --> 27:00.900
然后这里这里少了一个那个

27:01.060 --> 27:02.340
少了一个鞋杠

27:02.340 --> 27:03.700
把这个鞋杠补上

27:03.700 --> 27:04.180
把保存

27:05.860 --> 27:06.340
好

27:06.340 --> 27:08.100
那把这个删了嘛

27:08.100 --> 27:08.820
把这个删掉

27:10.500 --> 27:10.900
删除

27:12.930 --> 27:13.570
OK

27:13.570 --> 27:13.730
好

27:13.730 --> 27:14.690
现在的话空的

27:14.690 --> 27:15.090
好了

27:15.090 --> 27:15.970
这样我们这边我们再来

27:16.930 --> 27:17.250
重新

27:17.810 --> 27:18.210
胜的

27:18.850 --> 27:19.490
是不是搞定了

27:20.370 --> 27:21.010
对不对

27:21.010 --> 27:22.770
你看这边那就搞定了

27:22.770 --> 27:23.730
然后你这边的话

27:23.730 --> 27:24.530
你看一下

27:24.530 --> 27:25.730
和你的这个接口文档

27:26.690 --> 27:27.970
和你的接口文档

27:27.970 --> 27:28.690
是对得上的

27:29.490 --> 27:29.890
对不对

27:29.890 --> 27:31.490
一定要和这个接口文档对得上

27:32.370 --> 27:33.330
一定要和他对得上

27:34.210 --> 27:34.530
没有吧

27:35.170 --> 27:35.410
好

27:35.410 --> 27:36.290
然后这边

27:36.290 --> 27:37.650
让我们如果上传一个很大的

27:38.450 --> 27:38.770
现在的话

27:38.770 --> 27:40.290
这个上传他这就有了

27:41.490 --> 27:42.130
看不看

27:42.130 --> 27:43.010
比我们再来一个吧

27:43.970 --> 27:45.010
再来一个

27:45.010 --> 27:45.410
选择

27:46.610 --> 27:47.730
选择一个比如这个

27:49.740 --> 27:50.140
打开

27:50.860 --> 27:51.100
走

27:52.060 --> 27:53.100
是不是OK了

27:53.100 --> 27:53.660
对不对

27:53.660 --> 27:55.020
然后回头这边来漏一眼

27:55.500 --> 27:56.060
这就有了

27:57.260 --> 27:58.300
这里这张图片

27:59.260 --> 27:59.740
这张图片

28:00.300 --> 28:01.260
这就有了

28:01.260 --> 28:01.900
对不对

28:01.900 --> 28:02.220
好了

28:02.220 --> 28:03.740
让我们如果选择一个很大的

28:04.780 --> 28:05.420
选择一个

28:06.060 --> 28:07.340
比如这个这个有7兆

28:07.980 --> 28:08.380
看到没有

28:08.620 --> 28:09.420
这个有7兆

28:09.900 --> 28:11.180
这是上尔达的一张图片

28:11.180 --> 28:11.740
打开

28:12.460 --> 28:12.700
走

28:13.340 --> 28:13.740
你看

28:14.220 --> 28:15.020
这边是不是

28:15.260 --> 28:17.100
抛出我们自己定义的这个错误

28:18.220 --> 28:18.620
对不对

28:19.100 --> 28:20.140
抛出我们自定义的错误

28:21.180 --> 28:21.980
那支持的话

28:21.980 --> 28:23.980
我们的这个上传接口

28:24.460 --> 28:25.260
也就写好了

28:25.820 --> 28:27.180
上传接口也就写好了

28:27.180 --> 28:29.100
大家下来的话把这个上传接口

28:29.500 --> 28:30.380
把它写一下

28:30.540 --> 28:31.980
然后写了之后你用什么呢

28:31.980 --> 28:33.660
用这个postman来测试

28:34.380 --> 28:34.940
知道吧

28:34.940 --> 28:36.220
用postman来测试

28:36.220 --> 28:37.580
这postman你这边

28:37.580 --> 28:39.100
上传文件这边是不是也可以

28:39.500 --> 28:40.300
也可以上传

28:40.860 --> 28:41.260
对不对

28:42.300 --> 28:43.740
好这期课就先到这里

28:43.740 --> 28:44.700
再见

