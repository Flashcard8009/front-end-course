WEBVTT

00:01.580 --> 00:05.420
好 同学们 这期课我们继续来看这个后台管理系统

00:05.680 --> 00:08.480
我们这期课的话 主要来看一下这个键圈

00:09.260 --> 00:13.860
然后截止到上节课的话 我们已经把这个登录功能已经做出来了

00:14.120 --> 00:15.140
好 比如说我们这边

00:15.660 --> 00:19.240
我们这边的话 and the mean 然后6 5 4 3 2 1

00:19.500 --> 00:20.520
然后接下来这边

00:20.780 --> 00:22.320
vf

00:22.820 --> 00:23.600
m

00:23.860 --> 00:25.640
然后6 点击这个登录

00:25.900 --> 00:27.940
点击登录的话 是不是登录进去

00:28.460 --> 00:31.020
对不对 上节课的话 我们是把这个效果做出来了

00:31.240 --> 00:33.520
但是我们现在的话是没有做任何键权的

00:33.780 --> 00:36.040
你看我们上节课的话 我们这边是把这个

00:36.600 --> 00:38.400
把这个permission 这个文件

00:38.660 --> 00:39.680
我们是把它注释掉的

00:40.200 --> 00:43.000
那我现在的话把这个 你看他这边后面写的有注释 有没有

00:43.260 --> 00:46.080
permission control 就是控制你的这个访问权限

00:46.340 --> 00:48.120
那我这边让我如果我把它打开

00:48.880 --> 00:50.440
重新打开 然后再保存一下

00:50.940 --> 00:53.000
保存一下之后 然后接下来的话 你看这边

00:53.500 --> 00:54.280
这边他是不是

00:54.780 --> 00:58.120
回到这个登录 然后接下来你再登录的话 是不是登录不上去的

00:58.880 --> 00:59.400
对不对

00:59.860 --> 01:02.680
6 4 3 2 1 然后接下来这边

01:02.940 --> 01:03.960
A1

01:04.220 --> 01:05.240
SW

01:05.740 --> 01:06.780
好 大家这边走

01:07.040 --> 01:08.560
看 这不登录不上去

01:09.080 --> 01:12.160
而为什么登录不上去呢 就是因为你这边的话 他这边

01:12.420 --> 01:14.720
开启了这个权限的这个验证

01:15.220 --> 01:17.260
然后他的这个前线的验证

01:17.520 --> 01:18.300
就是这个文件

01:18.800 --> 01:19.580
permission这个文件

01:20.100 --> 01:23.940
所以这节课的话我们主要就是干嘛呢 主要就是研究这个文件

01:24.960 --> 01:28.020
就是看一下他这个permission 究竟是什么意思

01:29.700 --> 01:32.700
好 那么我们这边的话 首先来看一下他这个代码

01:33.260 --> 01:35.940
好 这边的话从这里 从十一行开始

01:36.660 --> 01:40.780
十一行开始的话 他这边看上的一个这个white list

01:41.340 --> 01:45.260
然后接下来他给了一个数组 数组里面 给了一个什么呢 给了一个这个logging

01:45.900 --> 01:47.980
也就是说这个是你登录的这个路径

01:48.460 --> 01:50.540
啊 这个叫做什么呢 这个叫做白名单

01:51.140 --> 01:52.580
你根据这个单词也知道

01:53.420 --> 01:53.980
白名单

01:54.740 --> 01:57.740
什么叫做白名单 就是不需要权限这个验证的

01:58.120 --> 02:01.200
可以直接去的 你就把它放到这个数组里面

02:01.800 --> 02:06.560
对不对 好 然后接下来下面 下面的话他这边是不是设置了一个前置守卫

02:07.480 --> 02:12.560
router点before一起啊 这个的话是大家学过的 这个是vue里面的路由

02:13.480 --> 02:14.280
前置守卫

02:16.680 --> 02:22.040
前置守卫 我们来看他前置守卫 做了一件什么事情 首先的话他是不是去拿这个token

02:23.280 --> 02:27.960
对不对 拿这个token 好到现在这边就分两种情况了 好 你这边把他折起来

02:28.780 --> 02:29.420
把他折起来

02:30.220 --> 02:37.460
啊 折起来 你看这边 是不是首先拿token 拿了token之后 大家判断你是否有token 如果有token进衣服

02:37.980 --> 02:42.180
对不对 没有token进alc 那我们看一下alc里面在做什么事情

02:42.980 --> 02:46.900
alc里面啊 进入alc说明什么呢 说明是不是 has no token

02:47.500 --> 02:51.460
这就是没有这个token 没有这个token之后 然后加这边又做了一个判断

02:52.140 --> 02:56.420
判断什么呢 判断你要去的是否是白名单里面的内容

02:58.060 --> 03:05.220
看到没有 是否是白名单 因为你这个white list他是一个什么吗 他是个数组吗 数组的话我是不可以调这个index of

03:06.260 --> 03:12.020
对不对 然后接下来我找看找不找得到 如果能够找得到 说明你是去的是这个白名单的

03:12.660 --> 03:19.540
什么叫白名单 白名单是不是就不需要这个权限的 对不对 让我干嘛让我这边lext直接放行

03:20.660 --> 03:23.860
看到没有 直接放行 那进入alc

03:24.480 --> 03:28.680
进入alc的话 说明你的这个要进了这个页面 再不在白名单里面

03:30.000 --> 03:33.200
是没有在白名单里面 对不对 你看他这边写的有注射

03:34.000 --> 03:39.480
那你进了就是什么 进了就是other pages 什么叫other pages 就是不在白名单里面的

03:41.160 --> 03:42.560
啊 不在

03:43.760 --> 03:51.580
白名单里面的 对不对 other pages 那你就干嘛呢 do not have permission

03:52.200 --> 03:57.480
你就没有这个权限 原因很简单你talking都没有 对不对 那你就不具备这个权限

03:57.960 --> 04:03.760
啊 那这个的话就是这里这个l4啊 我这边就把你导航到哪里去了 我帮你导航到这个登录

04:04.440 --> 04:09.160
克拉米亚啊logging 把你导航到这个登录啊 这个是l4里面

04:09.920 --> 04:11.040
好 那接下来进if

04:12.920 --> 04:17.160
if的话就说明什么了 说明你是有talker 对不对啊 说明

04:19.040 --> 04:21.200
说明你有talk

04:22.560 --> 04:30.960
看到没有 有talker的话 我这边他就又分为几种情况 这边我首先看嘛看看什么呢 看你去的是否是logging

04:32.560 --> 04:36.880
你现在有talker这样你去的如果是这个logging 让我是不是直接放行

04:37.840 --> 04:40.600
对不对 如果这边登录进去了好 直接放行

04:42.200 --> 04:50.040
把他连接到哪里去了 连接到这个首页 对不对 好那接下来如果进l什么来看一下 如果进l说

04:50.500 --> 04:53.540
进l是说明什么 说明是不是进的是

04:55.100 --> 04:57.620
进的不是logging

04:59.540 --> 05:05.700
对不对 进的不是logging 进的不是logging 然后接下来我干嘛呢 我看你本地有没有用户信息

05:06.340 --> 05:12.540
就那个views里面 大家还记不记得我们上节课我们登录的话 我们是不是在那个views里面存储了用户信息

05:13.260 --> 05:16.460
对不对 让我这边让我就看你是否有用户信息

05:17.240 --> 05:19.160
看一下

05:20.480 --> 05:21.080
是否

05:22.160 --> 05:23.960
有用户信息

05:25.320 --> 05:28.600
那如果有用户信息 好 那接下来我们这边

05:29.200 --> 05:32.880
是不是放行 对不对 那如果进l是进l是说明什么呢

05:34.040 --> 05:34.840
进入l

05:36.600 --> 05:36.960
说明

05:38.480 --> 05:40.840
没有用户信息

05:41.640 --> 05:43.920
但是呢 你又有talker

05:44.900 --> 05:46.860
对不对 你又有talker

05:47.500 --> 05:54.300
那既然你没有用户信息 但是你又有talker 让我接下来我用这个talker 是不是去拿一下你的用户信息

05:54.740 --> 05:56.100
对不对 接下来

05:57.180 --> 06:01.540
就使用你这个local storage

06:02.740 --> 06:03.860
local storage

06:04.640 --> 06:08.800
storage里面的这个talker

06:09.560 --> 06:14.000
去服务器拿用户信息

06:15.080 --> 06:16.480
看到没有 说你看他这边

06:17.480 --> 06:20.400
这边让他就干嘛 store.dispatch

06:20.720 --> 06:23.600
接下来这边有个user getinfer

06:24.080 --> 06:27.840
这个getinfer的话 其实就是以前袁老师给你们讲的who am i

06:28.560 --> 06:32.600
总之的话就是从那个服务器获取我的这个用户信息

06:33.340 --> 06:39.580
拿这个talker去获取 获取了这边的话 如果获取成功 那接下来我们这边的话

06:40.140 --> 06:41.860
是不是就直接放行next

06:42.540 --> 06:46.180
那否则的话 这边catch catch的话说明什么呀 说明你的

06:47.100 --> 06:48.300
这个talker是不是有问题啊

06:49.140 --> 06:54.860
对不对 你进入catch的话 肯定说明你talker有问题 有问题我这边干嘛呢 你看这边store.dispatch

06:55.180 --> 06:56.980
UserResetTalker

06:57.640 --> 07:03.280
所以重置你的这个talker 然后接下来把你导航到哪里去 所以把你导航到登录页面

07:04.320 --> 07:08.680
看到没有 这个就他整个流程 我把这两个给大家看一下 就是这里的话

07:09.040 --> 07:10.240
dispatch user

07:10.880 --> 07:12.080
user的话

07:13.520 --> 07:14.000
store里面

07:15.280 --> 07:15.600
这边

07:16.760 --> 07:20.280
这边这个是logging 然后接下来下面 你看下面是不是有个getinfer

07:20.940 --> 07:21.900
这获取用户信息

07:22.660 --> 07:27.860
对不对 然后接下来在下面 在下面是不是有一个这个这里 这边有一个这个resettalker

07:28.420 --> 07:30.340
对不对 他做的事情就是什么呢 就是

07:31.220 --> 07:35.380
删除掉你的这个talker 为什么删除掉 因为你这个有问题吗

07:36.020 --> 07:43.380
对不对 我这边通过这个getinfer 我去拿这个数据的时候出错了吗 那说明这个talker有问题 要么过期了

07:43.860 --> 07:44.940
要么被篡改了

07:45.560 --> 07:52.240
对不对啊 说说我这边需要先把你的这个talker先给他拿掉 拿掉之后 然后接下来把你重新

07:52.680 --> 07:54.280
来导航到登录页面

07:54.960 --> 07:59.880
所以你看他这边啊 就他这个框架里面 他的这个健全的流程

08:00.440 --> 08:01.240
就是这个样子的

08:01.920 --> 08:07.040
啊 你这边的话 你可以把他的这个代码 你把它看一下 我这里的话我总结了一个图

08:08.280 --> 08:09.080
在这个位置

08:10.060 --> 08:16.100
在这个位置啊 我们来看一下 这个的话是什么呢 这个是vue element and命中的

08:16.820 --> 08:19.500
这个健全的这个流程啊 我们来看一下

08:20.260 --> 08:26.420
看一下这个图哈 首先的话是不是路由跳转 对不对 路由跳转的话 接下导航守卫是不是会把你拦下来

08:27.220 --> 08:32.500
对不对 拦下来进行这个灵空考问 那考问的第一件事情是什么 你回到他的代码

08:33.100 --> 08:33.980
我把他代码移过来

08:35.020 --> 08:38.860
啊 回到这个代码 你看考问的第一个是什么 我把他折起来

08:39.380 --> 08:42.020
是不是是否有这个脱坑

08:42.860 --> 08:47.940
对不对 说你看这边 第一个是就是是否有这个脱坑 那如果是

08:48.660 --> 08:51.900
那如果是 是的话 然后接下来的话 我这边我看你

08:52.740 --> 08:55.940
呃 是的话 这边进入到这个

08:56.940 --> 09:02.780
啊 先看否嘛 先看否 先看否 啊 否的话 这边这边的话 是不是就是否在这个白名单中

09:03.820 --> 09:08.060
对不对 啊 如果是在这个白名单中 我们就这个放行

09:08.800 --> 09:13.760
啊 如果不在这个白名单中 我就把他干嘛呢 我就把他导航到这个logging

09:14.720 --> 09:15.800
你看 首先这个分支

09:16.680 --> 09:21.760
这个分支搞清楚没有 我们这边再来看一下他代码哈 你看这边是否有这个token

09:22.400 --> 09:28.400
haz token 这个token是根据他这边写了一个方法啊 叫做这个get token get token在这上面

09:28.880 --> 09:32.680
啊 在这上面 这边去拿这个token啊 你一层层去追

09:33.580 --> 09:38.900
看了没有 你看框架的话就是这样子的 一层一层去追 那你这边看到这个token 这个token是不是来源于

09:39.380 --> 09:44.020
这个utils的这个os 下面 那你这边的话就去看utils

09:45.460 --> 09:48.060
utils 下面是不是有一个os 在这个位置

09:49.260 --> 09:55.620
看了没有 这边是不是有一个这个get token get token 其实就是怎么样 是不是 他这边是从这个cookie里面去拉的这个token

09:56.700 --> 10:02.260
对不对啊 回头我们要改造的啊 这个我们要改造的 我们先把他就是他框架他本身写的这个

10:02.560 --> 10:06.160
健全的流程 我们先把他搞清楚 回头我们来改造

10:06.800 --> 10:11.120
好 那接下来这边这边没有这个token 没有token的话 是不是查看是否在白名单里面

10:11.560 --> 10:16.400
如果在 放心 如果不在 是不是给你导航到logging 你看是不是就是这个流程图

10:17.200 --> 10:24.440
对不对 是否在白名单里面 如果在啊 放心 对不对 如果不在好 我给你导航到logging

10:25.040 --> 10:29.480
ok 好 这条路就通了哈 好 那接下来如果有token

10:30.460 --> 10:36.780
有token 有token的话 你看他这边的流程是什么 有token的话 然后接下来他这边做了一个这个判断

10:37.340 --> 10:39.220
看你是否是去logging

10:40.300 --> 10:49.780
对不对 是否去logging 你如果是去logging的话 但是你现在的话你是登陆了的 你是处于登陆状态 我就给你干嘛呢 我就给你导航到这个首页

10:50.580 --> 10:56.500
啊 这边 看你是否是去这个logging 如果这个是的话 呃 这边的话

10:57.480 --> 11:05.120
呃 这边的话 其实应该是给人家导航到首页哈 这个流程图 这边要改一下 就这个位置是其实是导航到首页

11:05.760 --> 11:07.680
啊 然后如果否的话

11:08.880 --> 11:15.080
如果否的话 就是这边 如果不是的话 不是的话 我这边干嘛呢 我这边是不是先去拿这个用户信息

11:16.160 --> 11:21.800
对不对 先去拿这个用户信息 从这个store里面去获取这个用户信息啊 你看这边下一步

11:22.300 --> 11:24.820
是不是看一下是否有用户信息

11:25.580 --> 11:36.340
如果是的话 那是不是放心 对不对 如果否的话 你没有用户信息 没有用户信息 但是你又有什么呢 你又有什么 你看这边 他就进哪里 进l4

11:36.740 --> 11:40.620
进l4 你如果没有用户信息 但是你又有什么呢 你又有token

11:41.540 --> 11:46.540
那我是不是应该去验证你的这个token 对不对 说接下来流程就来到这边

11:47.160 --> 11:49.560
来到这边 去验证你的这个token

11:50.400 --> 11:56.600
啊 验证他的有效性 如果他这边的话 这个验证的这个token 他如果是通过 通过的话 这边是不是放心

11:57.160 --> 11:59.680
否则的话 把他导航到哪里去 导航到这个

12:00.520 --> 12:06.960
logging啊 如果否的话 就是走上面这条路 打好那logging 如果验证通过啊 就是这边就放心

12:07.960 --> 12:12.520
看到没有 这个的话 就是整个这个vue element enemy 他里面的这个

12:12.980 --> 12:19.600
健全流程啊 除了就是刚才哪个位置啊 除了刚才这个位置

12:20.160 --> 12:23.160
这个位置 这个的话 位置他就是过来之后 就这一步

12:23.800 --> 12:31.800
这一步他看你是否去这个logging 如果是去logging的话 他是去给你导航到哪里去导航到首页啊 这边的话要改一下 就这里要改一下 这里的话

12:32.560 --> 12:37.160
其实也算是放心的 也算是放心 只不过会给你导航到这个首页

12:37.840 --> 12:42.720
啊 会导航到首页 好这个的话 就是他整个这个vue element enemy里面的

12:43.220 --> 12:46.780
健全流程 但他这个流程的话啊 我们这边的话要进行改

12:47.380 --> 12:50.300
怎么改呢 就是你首先的话 他这里是不是有一个这个白名单

12:51.140 --> 12:54.980
对不对 有一个白名单 有个白名单的话 他这边的话 他采取的是这种方式

12:55.580 --> 12:59.540
就是我把就是不需要全线的 我全部写到这个数组里面

13:00.500 --> 13:05.540
啊 全部写在数组里面 但这里的话 你如果就是你的路由比较多的话 那你这边是不是要一个一个

13:05.900 --> 13:11.500
写到这个数组里面 对不对啊 比较麻烦啊 我们来看一下我们这边 我们这边的话 我们来进行一个

13:11.960 --> 13:16.560
小小的改造 怎么改造呢 首先来到你的router.js

13:17.840 --> 13:20.200
router 我们找到这个router啊 来到这边

13:21.040 --> 13:25.960
这边是不是你配置路由的地方 对不对 这边是你配置路由的地方

13:27.400 --> 13:34.800
那么我们可以在这个位置来配置 他是否需要这个全线的这个验证啊 这个的话也是之前元老师讲过的 对不对

13:35.120 --> 13:37.920
你在哪个位置呢 比如说这边 第一个 第一个是这个logging

13:38.220 --> 13:45.220
logging是不需要这个全线的 对吧 那404404也不需要全线 好那接下这个 这个的话是不是需要全线

13:45.980 --> 13:51.020
对吧 那我在这里的话我就配置一个 配置一个什么呢 配置一个这个orce

13:51.980 --> 14:03.220
然后去代表这个的话是需要健全的好了 接下来后面的话就是一葫芦花飘 你哪些需要健全你就把这个需要健全的这个路由这个meta里面

14:04.040 --> 14:10.840
给他加上这个orce 这个orce啊 冒号去就可以了 那么继续往下面 下面的话是这个banner

14:11.560 --> 14:18.320
啊banner的话这边也是啊 这个我是之前加过的啊 我已经加过了 我们这边来看一下啊 这边的话这个

14:19.560 --> 14:26.160
啊 这个是这边banner啊 banner的话这边啊orce去 然后接下来的话这边blog 看到没有

14:26.760 --> 14:33.040
然后接下来的话这边是blog菜谱 也就是我凡是需要健全的 我这边都给他加上什么呀

14:33.360 --> 14:42.400
是不是加上这个orce 然后冒号去哦 对不对 给他这么一个属性 给他这么一个属性之后啊 我这边应该是加完了的啊 这个提前加好了

14:43.040 --> 14:49.200
这边看到没有 都加好了啊 加好了之后 然后接下来来到我们的这个permission

14:49.760 --> 14:53.120
这边 那接下来的话我们就干嘛呢 我们来改造

14:54.040 --> 14:57.880
这个permission 我把他原本的这个健全的话 我们就把它注释掉

14:58.660 --> 15:00.820
我们这边从这个位置开始注释

15:02.060 --> 15:09.860
好 我们从这个位置 从这边啊 衣服就整个他这边他的这个逻辑 从这儿到这儿 我们全部给他干掉

15:10.220 --> 15:14.100
啊 我这边让我给你写个注释啊 我给你写个注释 下方是

15:15.820 --> 15:18.460
下方是这个vioe

15:19.500 --> 15:21.340
vioe element

15:23.260 --> 15:23.940
element

15:25.620 --> 15:26.060
and the mean

15:27.040 --> 15:31.080
然后原本的健全流程

15:32.600 --> 15:40.480
对吧 他原本的健全流程 那我们这边的话 我们要对他进行一个这个改造啊 他这个原本的健全流程刚已经讲过了啊 这边不再多说了

15:40.880 --> 15:46.320
好了 接下来我们这边 我们这边怎么来改造呢 我们这边的话一开始的话 我们其实可以这个样子

15:46.920 --> 15:51.320
啊 我这边有图啊 你看一下 这这个是他原本的 这个是他原本的 我们来看改造后的

15:52.300 --> 16:00.340
改造后的 改造后的话 我这边是这样子的 就是一进来啊 那首先导航守卫还是把他拦下来 对吧 进行这个灵魂的考问

16:01.140 --> 16:05.300
啊 考问什么呢 首先我就判断他是否需要权限

16:06.020 --> 16:09.020
啊 他这边的话是先判断的 是否有talk

16:09.780 --> 16:14.740
对吧 我这边的话我就先判断什么了 判断是否需要权限

16:15.500 --> 16:18.820
那如果否 否的话说明是不是就是不需要权限

16:19.440 --> 16:23.600
对不对 不需要权限的话 然后接下来我这边判断你是否是去这个logging

16:25.240 --> 16:29.120
如果你不是去logging啊 不是去logging 但是呢 你去的就是这个

16:30.400 --> 16:33.040
不需要权限的页面 那我干嘛呀 我是不是直接放行

16:34.080 --> 16:39.800
哎 理解一下这个思路哈 同学们 理解一下这个思路 再说一遍 首先我判断你 你是不是不需要权限

16:40.280 --> 16:46.360
对吧 你去的这个页面不需要权限 不需要权限 让我还需要判断一下什么呢 我还判断一下 你是否是去的这个logging

16:47.020 --> 16:52.220
你如果去的也不是logging 那你行吗 因为就是去的是什么呢 去的是不是logging的

16:52.540 --> 16:56.500
不需要权限的页面 让我干嘛呢 我是不是直接放行啊

16:57.820 --> 17:01.980
是不是这个道理啊 对不对 那你如果的话你这边是去的这个logging

17:03.180 --> 17:08.220
是啊 你现在是去的logging 然后接下来我要判断什么呢 我判断你是否已经登陆

17:09.700 --> 17:12.500
我判断你是否已经登陆 如果你已经登陆

17:13.460 --> 17:15.700
我给你导航到哪里呢 我给你导航到首页

17:17.140 --> 17:22.700
然后接下来如果你没有这个登录 这里写错了啊 这里的话我得把它改一下

17:23.380 --> 17:26.380
我得把它改一下啊 稍微等一下 我这边把它改一下

17:28.300 --> 17:31.060
这边的话 我把那个图打开啊

17:32.100 --> 17:38.530
我把这改一下啊 稍微等一下 我这边的话我把它改一改

17:46.620 --> 17:55.860
好 我这边让我把它啊 这边打开了啊 打开了之后 然后这样我这边把它改一下好 然后接下来如你是否已经登陆 如果已经登陆的话我这边是否把你导航到首页

17:56.300 --> 17:57.540
对不对 然后接下来你如果否

18:00.130 --> 18:00.690
如果

18:03.900 --> 18:10.900
如果否你没有登录 没有登录的话 那你现在又是要去这个logging 是不是导航到这个logging

18:11.860 --> 18:17.580
对不对 导航到logging啊 我把这个图重新解一下啊 重新解一下

18:19.020 --> 18:21.380
好 稍微等一下 我把这个图重新给大家解一下

18:27.380 --> 18:31.020
这个怎么回事 稍等一下 稍等一下 我这边让我把它

18:31.960 --> 18:32.200
好

18:34.160 --> 18:37.360
哎 这个这个马上啊

18:39.360 --> 18:43.160
马上 这样子我把视频暂停一下 暂停一下 我先这边把它解一下

18:44.960 --> 18:49.080
好 这边已经重新弄了啊 这边的话 如果你这边的话

18:50.080 --> 18:54.920
你是去这个logging啊 我再说一遍 如果你是去logging 是去logging 然后这样我看你是否登陆了

18:55.480 --> 19:02.320
你如果都登陆了 你还去logging干嘛呢 我给你导航到首页 对吧 但是你如果没有登陆的话 那我就干嘛呢

19:02.520 --> 19:06.640
你是不是你要去logging 是吧 好 那我就让你去logging 就相当于你要去这个登陆页面

19:07.160 --> 19:10.760
看到没有 这个的话就是这条线啊 这个就是这条线

19:11.400 --> 19:19.920
搞清楚没有 好 那这样我们来看 如果的话你这边是需要全线 好注意 这边的话就会有一系列的这个验证了

19:20.160 --> 19:24.000
如果需要全线 是吧 让我首先看你 是否有用户信息

19:25.120 --> 19:29.920
就什么呢 就是你的vlogs里面 有没有用户信息 如果你有ok 那我放心

19:30.660 --> 19:32.060
对不对 那如果没有

19:33.380 --> 19:36.700
没有的话 我就该干嘛呢 我看你是否有token

19:37.860 --> 19:40.820
啊 有token 那有了token之后 我就直接放行吗

19:41.580 --> 19:47.780
啊 你有token我就放行吗 不 我还需要干嘛呢 我还需要验证你这个token 就是走下面这一步

19:48.180 --> 19:53.180
对吧 因为你现在的话 你虽然有 有是有这个token 但是你的token可能过期了呀

19:54.040 --> 19:55.800
对不对 可能被篡改了呀

19:56.600 --> 20:02.720
对不对 说我接下来我还需要验证你的这个token的这个有效性 怎么验证呢 其实就是那个互mi

20:03.560 --> 20:05.520
对不对 之前袁老师给大家讲的互mi

20:06.040 --> 20:14.160
啊 那接下来验证 验证了 接下来如果验证通过 我们干嘛呢 我们放心对不对 那如果没有通过干嘛 重新导航到

20:14.600 --> 20:19.800
logging也免 啊 并且你导航过去的时候 你还需要把他的这个token是不是给他删除掉

20:20.540 --> 20:23.300
对不对啊 你看这个就是我们改造后的流程

20:24.420 --> 20:31.380
啊 你这边的话 可以把这个视频暂停一下 暂停个几秒钟 这样你先老子里把这个流程过一遍

20:32.020 --> 20:37.620
啊 你先把它过一遍 过一遍之后 这样我再来带着大家写啊 你把视频暂停一下吗

20:39.100 --> 20:42.100
好 然后接下来的话 我们这边的话 我们就开始来写这个

20:43.340 --> 20:45.580
啊 把这个拖保存一下吧 好 那接下来这边

20:46.200 --> 20:49.120
这边 那我们就开始来写啊 这边的话我首先我来

20:50.000 --> 20:53.640
第一步 我们来看第一步 第一步的话是判断他是否需要权限

20:54.640 --> 20:56.240
对不对 所以接下来的话 我们这边

20:57.480 --> 21:02.320
deaf 意思是什么呢 2.meta

21:03.320 --> 21:04.440
点24

21:06.200 --> 21:11.280
对吧 那这样啊 这边肯定会有一个对应的 else 那进入到eaf

21:12.280 --> 21:12.600
说明

21:13.580 --> 21:17.060
说明页面 需要

21:17.780 --> 21:20.900
健全 对吧 那接下来进入 else

21:21.900 --> 21:25.460
说明该页面 不需要

21:26.660 --> 21:34.060
健全 对不对 好 那接下来我们先来写这个不需要健全的 那不需要健全的 好看这个流程图啊看这流程图

21:34.500 --> 21:38.180
啊 不需要健全的 然后这样我还需要判断一下他是否是去的是这个

21:38.920 --> 21:43.320
locking 那接下来这边走 接下来这边就是 eaf

21:45.240 --> 21:53.360
eaf 什么呢 2.pass 2.pass 如果等的与一个什么呢 等于一个这个locking

21:54.720 --> 22:01.380
说明你是不是失去的locking 对不对 那接下来这边 else else

22:02.300 --> 22:08.220
else 那说明是不是不是去的这个locking 那不是去的locking 好办 那我这边的话就直接 next

22:10.140 --> 22:17.980
是不是放心 对不对 那你现在的话你失去的这个locking 失去的这个locking 你看一下我们这边我还要判了什么 我们还判了你是否已经登录了

22:19.180 --> 22:26.100
对不对 你如果已经登录的话 我就给你导航到什么 导航到这个首页 那你如果没有登录的话 就是直接就去locking就可以了

22:26.340 --> 22:28.140
说接下来的话 我们这边再加一条

22:29.060 --> 22:34.460
什么呢 你如果去的是locking 但是呢你这边的话又有这个用户信息

22:35.060 --> 22:37.820
啊 所以我们在上面的话 我们需要来获取一下用户信息

22:38.680 --> 22:45.560
这个就不要了啊 这个就不要了 这是他原来的啊 我们这边来获取一下这个用户信息 这边来就const

22:46.040 --> 22:49.720
一个这个has get user

22:50.840 --> 22:54.200
infer 这个等于什么呢 等于一个这个store

22:56.120 --> 23:04.560
store.getters 然后接下来点user 啊这个就是什么呢 这个就是获取本地用户信息

23:05.420 --> 23:16.500
获取本地用户信息 那回头的话 你这边的话就是这个getters的这个user这个地方 是不要进行改写 对不对 我们过去漏一眼

23:17.820 --> 23:21.980
啊 这边这边的话来到这个store

23:22.980 --> 23:30.100
store.getters user 我们找到这个getters store 下面这边getters啊getters他现在是不是这个样子的

23:30.800 --> 23:36.520
对不对 他是这个样子的 好 这些的话其实就都啊 也不是说都可以不要 把这几个这几个是不要的

23:37.000 --> 23:43.560
这个原本的他这个token啊veter name这个就不要 那我们这边就一壶路画票 这边啊就是user

23:44.600 --> 23:47.680
我们写个user user的话 这边的话就是应该是state

23:49.880 --> 23:51.880
state 然后接下来这边state

23:52.560 --> 23:58.240
点user 下面的user 啊他这边就拿什么呢 就拿你的这个user

23:59.100 --> 24:06.780
这个位置 这个位置的话 我们上一次呢 这边是不是有一个这个user 对不对 而拿你这个用户的这个信息

24:07.380 --> 24:09.380
啊 去获取 好 那这样回到这边

24:10.300 --> 24:17.260
回到这边 这边呢 就去获取这个用户信息 获取了之后呢 这个这个值是不是会返回给这个 has get user infer 里面

24:18.060 --> 24:20.660
对不对 返回之后呢 这样我这边就看他有没有这个值

24:21.640 --> 24:31.600
啊 has get user infer 如果你要去logging 但是呢 你又有这个用户信息 说明你是不登录过的 对不对 进入此一步

24:33.440 --> 24:41.400
说明 说明你现在是在登录的状态下

24:42.480 --> 24:47.160
要去登录页面 对不对 要去这个logging

24:48.060 --> 24:55.420
啊 登录页面 然后我们将他干嘛呢 我们将其导航到

24:56.460 --> 24:59.340
是不是首页 对不对 导航到首页 好

25:00.780 --> 25:10.320
啊 这边这边的话就直接next 然后这边这个pass pass啊 首页

25:11.120 --> 25:18.200
那是不是就是应该是这个样子的 对不对 整个这个 else 我们就写完了啊 大家这边无论是进衣服还是进 else

25:18.500 --> 25:23.140
然后完了之后 我们要让什么呢 让他那个进度条走完啊 进度条走完就是这样代码

25:25.750 --> 25:33.470
就这样代码 ok 好 这个就是这个 else 部分的逻辑 然后再来理一下啊 就是你进 else 说明什么 说明是不需要健全的

25:33.950 --> 25:38.990
不需要健全的话 本身的话 我们是应该是是不是直接放行就可以了 对不对 但是的话 我们还需要

25:40.150 --> 25:42.230
看一下 他是否是去的这个logging

25:43.150 --> 25:48.910
如果他去的是logging的话 那如果他又已经登录了 那我就干嘛呢 我就直接把他导航到首页

25:49.210 --> 25:52.370
你注意哈 就是这边的话 现在都是这样做的 比如说我举个例子

25:53.770 --> 25:56.010
举个什么例子呢 比如说b站吧

25:57.130 --> 25:57.730
比如说b站

25:59.290 --> 26:00.090
呃bilibili

26:01.050 --> 26:02.290
bilibili

26:03.930 --> 26:08.250
啊bilibili bilibili的话 然后接下来我你看我现在是不是处于这个登录状态

26:08.890 --> 26:12.650
对不对 那我现在的话 我这里这里这样子 我先退出

26:14.010 --> 26:16.290
我先退出 退出之后再将我点登录

26:17.270 --> 26:21.990
点立即登录 点立即登录的话 然后接下来这边是不是有一个这个logging

26:22.630 --> 26:27.870
对不对啊 这个logging 我们先把这个先把他复制啊 复制下来之后再将我这边让我点击这个登录

26:30.300 --> 26:36.380
好 我这边呢 登录一下啊 这边需要我的这个手机号 我这边的话去获取一下验证码

26:41.210 --> 26:42.890
ok好 我这边填写一下验证码

26:44.450 --> 26:54.660
好 大家这边我们登录 这边那时候已经登录成功了 对吧 完成登录之后

26:54.680 --> 27:00.400
然后接下来的话 他这边来到这个首页 来到这个首页之后 然后接下来你看我这边 我现在是不是处于登录状态

27:00.800 --> 27:05.880
登录状态 然后接下来我这边我强行 这边要跳转到这个logging 你大家注意看哈 这边走

27:06.640 --> 27:09.760
是不是这边logging 但是他马上会干嘛呢 马上会给我跳过来

27:10.640 --> 27:15.800
看到没有 因为你现在已经登录了呀 你登录了 你还跑到那个登录页面去干嘛呢 对不对

27:15.800 --> 27:19.400
所以说我过去过去之后他这边就在验证 验证之后大家这边过来

27:20.480 --> 27:24.320
看到没有啊 所以说我们这边哈 回到我们这边

27:25.640 --> 27:31.080
回到我们这边 说我这边就直接给你导航到 是不是首页 对不对 好那接下来的话下一步

27:31.560 --> 27:37.040
下一步的话 然后接下来就是这边的啊 衣服 衣服的话就是这条线了 注意就是这条线了

27:37.640 --> 27:43.960
就是这边这条线了啊 就是这边这条线 这这条线我们已经走完了啊 这条线已经走完了 下次走这条线了

27:44.400 --> 27:50.320
这条线的话 这样如果需要健全 我们首先第一步 第一步是不是 看一下是否有这个用户信息啊

27:51.200 --> 27:54.360
对不对啊 看一下是否有用户信息 说接下来的话 这边

27:54.920 --> 27:59.480
衣服 衣服什么呢 has get

28:01.040 --> 28:05.760
UserInfer 看你是否有这个用户信息啊 那接下来这边就又是一个分子

28:07.680 --> 28:11.480
对吧 大家这边进入此衣服 进入此衣服

28:12.840 --> 28:15.120
是 if 说明

28:16.720 --> 28:17.760
有用户信息

28:19.440 --> 28:23.360
用户信息啊 这里说的有用户信息指的是

28:24.180 --> 28:30.700
那个views里面 就你本地仓库里面有用户信息啊 那接下来的话怎么做呢 直接放行啊

28:32.340 --> 28:33.980
对不对 直接放行

28:36.020 --> 28:43.260
直接放行啊 然后接下来如果进l 进l时的话说明什么呢 说明没有 没有的话 那这样我们干嘛呀 对不对

28:43.740 --> 28:47.780
没有用户信息 那这样我们干嘛 我们来看一下

28:48.760 --> 28:54.480
没有用户信息 然后既然是不是应该是走这个分子啊 对不对 干如果有用户信息 有用户信息直接

28:55.080 --> 28:59.400
放行 那如果没有 没有的话 我就需要看你是否有这个token啊

29:00.360 --> 29:04.280
啊 说说这里 没有用户信息 然后看一下

29:05.880 --> 29:06.520
是否

29:08.320 --> 29:08.480
有

29:09.800 --> 29:13.160
token 那接下来这边的话就直接const

29:14.600 --> 29:16.680
const一个 has token

29:18.900 --> 29:25.100
等于一个什么呢 token从哪去拿 是不是从这个local storage里面local storage点get item

29:25.700 --> 29:28.420
啊 我们这边呢是叫做and the main token

29:30.600 --> 29:34.680
对不对 去拿这个token 拿了这个token之后 大家看他是否有这个token

29:35.880 --> 29:36.280
if

29:37.560 --> 29:42.190
haz token 啊 大家这边 else

29:43.150 --> 29:47.990
啊 那进l时很简单 进l时的话说明是不是没有token 对不对 说明

29:49.950 --> 29:50.950
说明没有token

29:51.830 --> 29:54.430
那没有token的话 那就该干嘛嘛 是不是重新登录呀

29:55.270 --> 29:57.350
啊 所以需要

29:58.070 --> 30:00.230
重新进行

30:01.030 --> 30:05.230
登录 要进行重新登录的话 那我们这边的话就直接这边 next

30:08.180 --> 30:09.740
next 然后接下来这边

30:11.180 --> 30:16.660
呃 去这个 把它导航到哪里去呢 导航到这个logging 大家这边

30:17.600 --> 30:24.720
等于什么呢 等于一个这个 要去的这个pass 就登录之后我就直接给你导航到之前的那个pass

30:25.320 --> 30:28.840
啊 那接下来的话 把那个 把这个进度条 把它关掉

30:30.990 --> 30:37.030
看到没有啊 这个就是没有token的情况 那如果有token 有token的话就完事了吗

30:37.630 --> 30:41.390
啊 我回头来看一下 没有token 没有token的话 是不是给你导航到这个logging

30:41.830 --> 30:44.710
对不对 这条线我们就走完了 好那接下来如果有token

30:45.130 --> 30:50.370
有token的话 不是说有token啊 就可以 有token我们是不是还需要验证这个token的有效性

30:51.090 --> 30:52.490
对吧 万一你的token过期了呢

30:53.530 --> 30:55.570
对不对 说接下来的话 这边下一步

30:57.250 --> 31:02.020
有token 有token

31:03.140 --> 31:06.900
我们还需要验证一下

31:07.940 --> 31:10.540
token的有效性

31:11.740 --> 31:15.420
对吧 说接下来我们在这边 这边我们就通过一个这个try catch

31:17.300 --> 31:17.620
try

31:18.900 --> 31:19.300
catch

31:20.460 --> 31:22.180
啊 大家这边的话是arrow

31:24.740 --> 31:25.140
arrow

31:27.610 --> 31:32.210
ok 好 这边try try的话 然后接下来我们这边就干嘛呢 我们这边呢就是store

31:33.170 --> 31:40.930
点dispatch 然后接下来什么东西呢 这边呢就是user 下面的get infer

31:41.410 --> 31:44.930
啊 这边我们一会儿要去改造啊 就这里这里我们一会儿要去改造

31:45.910 --> 31:54.230
这个我们现在还没写 现在的话他这边的话是什么样子的 现在的话这边这个get infer

31:55.350 --> 31:56.830
get infer 他这边的话就是

31:57.910 --> 31:59.270
发的是这个get infer

32:00.270 --> 32:07.870
get infer 然后接下来这边 是吧 还是用的这个urr 对不对 回头我们这一块要去改 我们先把那边写完

32:08.850 --> 32:24.980
好 这边让我们就是get infer 这个就相当于是互mi 相当于大家之前学的互mi 啊 回头你看那个接口文档里面也叫互mi

32:26.140 --> 32:30.820
好 然后接下来这边 这边他是一个异步的过程 那说说我们需要干嘛呢 我们是不是需要等待

32:31.900 --> 32:37.460
对吧 需要等待 啊 去拿 拿了之后然后接下来我们干嘛呢 我们let's

32:38.240 --> 32:45.520
放心 啊 next 放心 那有同学会问你不是说验证这个talker的有消息吗 他如果不有效呢

32:45.920 --> 32:52.720
不有效的话 他是不是拿不到这个数据 对不对 他这边让dispatch这个get infer 他和服务器进行交互的时候 是不是拿不到用户信息

32:53.200 --> 32:55.600
拿不到用户信息的话 他就会进哪个呢 他就会进catch

32:56.440 --> 33:01.600
就我这边就会捕捉到 捕捉到之后呢 这样我这边就干嘛呢 我这边呢就直接store

33:02.380 --> 33:06.820
点dispatch 啊 然后接下来这边

33:08.620 --> 33:10.300
user 然后reset

33:13.270 --> 33:14.190
reset token

33:15.630 --> 33:19.470
啊 大家这边也是一个异步的 所以你需要等一下 所以接下来这边的话就是

33:19.870 --> 33:26.270
o wait 你等待一下 等待一下之后 然后接下来的话你这边的话就是 哎 把他导航到这个

33:27.250 --> 33:30.970
把他导航到这个登录页面 就这里啊 其实就这两句话

33:33.040 --> 33:41.640
把他导航到这个登录页面 导入到登录页面 你这边的话 就还可以谈一个这个弹框 他这边的话 应该是引了一个message 啊 这里message

33:44.250 --> 33:51.090
这边message message 然后下你这边啊 就可以有那么一段文字啊 这边message.arrow

33:51.510 --> 33:53.350
那下这边就

33:54.870 --> 34:00.510
就可以有那么一段文字 什么文字呢 就是这边 比如说这个登录过期

34:01.390 --> 34:12.070
因为你的token不可用了嘛 对吧 登录过期啊 请重新登录 请重新登录

34:12.990 --> 34:19.470
啊 这个这个message.arrow 这个message的话 是那个是element UI里面的一个组件 我给大家看一下

34:20.370 --> 34:21.170
在这边

34:22.410 --> 34:24.690
message 就这个就这个 其实我们昨天用过的

34:25.650 --> 34:31.930
对不对 我们昨天是用过的啊 只不过这边用的话 它是这个 我们是在方法里面用的 方法里面用的话 是直接

34:32.490 --> 34:33.970
z使点到的message

34:34.890 --> 34:38.010
啊 然后你也可以什么用呢 我看一下啊

34:39.570 --> 34:41.370
那就是这里 我们来看一下

34:42.110 --> 34:42.550
呃

34:44.390 --> 34:55.550
这这这这 看到没有 这边是不是写的呀 单独使用 怎么单独使用 你单独引入这个message 看到没有 从element UI里面引入 引入之后 然后接下来的话 你这边的话 就直接表message.sixense

34:55.790 --> 35:10.070
message.arrow 这些就可以了啊 所以你看我们这边就直接使用message.arrow 它到时候就会有个弹框 登录过期 请重新登录啊 那我们整个这个建权的话 我们整个这个流程就写完了

35:10.750 --> 35:11.270
就写完了

35:12.190 --> 35:19.990
啊 但是这个permission 这个写完了 但是我们就是后面这些地方是不是要改造 对不对 这这个比如这个getter info

35:20.390 --> 35:29.150
还有这个reset token 这些这些的话是不是还没改 对不对 所以现在的话 我们要先去改一下啊 在改之前的话 我这边建议你啊 建议你把这个

35:29.670 --> 35:30.870
视频先暂停一下

35:31.550 --> 35:34.910
你先把我这个写的代码 结合着什么呢 结合着这边

35:35.510 --> 35:38.390
改造后的这个建权的这个流程的这个图

35:39.030 --> 35:41.190
啊 我这边 你两个的话 你来看一下

35:41.510 --> 35:43.790
对比一下 你先把视频暂停一下 先看一下

35:45.350 --> 35:50.910
好 那么接下来 接下来的话 我们这边的话 我来改造这里啊 这里的话就是store.dispatch

35:51.630 --> 35:56.830
user get info 那接下来我们就需要来到这个store里面

35:57.950 --> 36:01.750
store 然后接下来user user 这边呢 是不是get info

36:02.470 --> 36:08.830
对吧 那接下来我们这边就需要发送请求 那我把这一块 这一块我就都给他注释掉 他原来的我先不动他

36:09.450 --> 36:14.210
啊 那接下来在这个地方 这个地方我们就该干嘛呀 这个地方呢 是不是就是应该是发送请求

36:16.660 --> 36:23.060
发送请求 那发送请求的话 我们去看一下这个API文档啊 找到这个API文档

36:24.420 --> 36:26.420
API文档在这个位置

36:27.500 --> 36:32.900
我们来看一下 在这个位置恢复登录状态这里 这里的话是不是就有这么一个

36:33.380 --> 36:34.100
互MI

36:35.020 --> 36:38.020
对不对 有这么一个互MI 好 那接下来这边复制一下

36:39.000 --> 36:41.440
复制了之后 你看他这里的话会返回这个

36:42.400 --> 36:48.920
呃 这个用户的这个信息 好 然后接下来在这个地方 这个地方我们首先的话是需要在这个user里面

36:49.560 --> 36:51.800
user里面我们这边是不是需要先把这个改一下

36:53.320 --> 36:55.680
对吧 需要先把这个东西改一下

36:56.960 --> 36:59.120
啊 这个的话就是我们的这个恢复登录

37:00.640 --> 37:01.440
恢复

37:02.640 --> 37:05.600
登录啊 那我们的这个talk的话我们不在这边带

37:06.600 --> 37:12.460
不在这边带 我们这边在哪带呢 我们在那个就是啊 请求拦截那里

37:13.820 --> 37:14.820
在这边request

37:15.900 --> 37:20.020
request啊 在这边 我们把这边的话 我们把什么呢 把这个token

37:21.740 --> 37:27.340
然后这边这边的话 我们就把这一块啊 这边它本来是从gailers的token 这个我们整个就不要了

37:28.100 --> 37:30.180
好 这边让我们来写 这边让我们就是

37:30.960 --> 37:31.560
const

37:32.000 --> 37:35.960
一个这个token 等于一个什么呢 等于一个local storage

37:36.720 --> 37:37.880
点get item

37:39.320 --> 37:42.320
item 然后接下来的话 这边and the mean token

37:44.710 --> 37:48.630
啊 然后接下来的话 这边 衣服这个token 如果有这个token

37:49.430 --> 37:53.110
那我们就把这个token加在哪里呢 加在这个config

37:54.150 --> 37:55.270
点haters

37:56.830 --> 37:58.390
haters 然后里面有个字段

37:59.370 --> 38:01.450
叫做什么呢 叫做这个

38:03.210 --> 38:08.330
autehr 然后ind

38:09.090 --> 38:12.930
啊 这个字段 然后接下来等于一个什么呢 等于一个这个beer

38:15.660 --> 38:18.460
然后加一个空格 一定不要把这个空格忘了啊

38:18.980 --> 38:24.340
这个之前就是有个学生这边 空格忘了 忘了之后 然后接下来解析老是通不过

38:24.600 --> 38:25.900
看到那个token又是带了的

38:26.620 --> 38:31.020
啊 看到token是带了的 但是这边的话 老是解析通不过啊 是这边这个

38:31.540 --> 38:36.640
少了一个这个空格 因为后台 它那个服务器它在解析的时候 它这边的话会以这个

38:36.900 --> 38:37.940
空格来进行分隔

38:38.440 --> 38:41.780
知道吧 好了 这边的话 把这个token 把它带上

38:42.540 --> 38:44.840
啊 那你看我这边 我这边是不是一个请求拦截

38:45.360 --> 38:47.140
那请求拦截的话 每一次

38:47.660 --> 38:51.500
进行一个这个请求的时候 那我是不是就会把这个token

38:52.520 --> 38:54.820
把它加在哪里呢 加在这个header里面

38:55.340 --> 38:55.840
对不对

38:56.100 --> 38:56.620
就带过去了

38:57.640 --> 38:59.180
好 那接下来的话 回到这里

39:00.460 --> 39:02.500
回到我们这边 这边是不是就ok了

39:03.020 --> 39:06.340
ok之后 然后接下来的话 也就这个方法是ok的

39:06.600 --> 39:09.680
这个方法是ok之后 然后接下来来到我们的

39:09.940 --> 39:13.260
dispatch那个地方 我们看在哪dispatch的

39:14.800 --> 39:16.340
dispatch这里

39:17.360 --> 39:21.460
这个位置 这个位置的话 那就应该是什么呢 是不是就是应该是get

39:21.920 --> 39:26.020
infer 是不是调这个方法 民众我没改 它这边都是给我引入了的

39:27.040 --> 39:32.160
get infer 这里这里 它从这个user里面是不是引入了的 对吧 民众我没改 所以我这边就直接

39:33.180 --> 39:34.220
直接get infer

39:34.800 --> 39:36.520
好 然后接下来这边干嘛呢

39:37.780 --> 39:41.700
这边的话 就是它会返回一个promise 所以我们这边的话就是z

39:42.660 --> 39:44.460
z然后接下来这边res

39:45.380 --> 39:52.980
然后过来 过来的话 然后接下来它就会分两种情况 就是有可能你是没有登录或者这个token过期

39:53.380 --> 39:57.220
那接下来它的这个返回的这个响应的话 是一个这个制服串

39:57.900 --> 40:00.660
是个制服串 然后我们这边就需要判断一下

40:01.980 --> 40:07.500
ef ef什么呢 ef type off type off res

40:08.220 --> 40:09.900
等于等于一个stream

40:13.180 --> 40:15.740
说明什么呢 说明这个token已经过期

40:16.500 --> 40:17.540
说明它未登录

40:18.820 --> 40:22.140
未登录或者token

40:22.900 --> 40:24.700
已经过期

40:25.980 --> 40:29.820
它已经过期了 那这边的话我们就干嘛呢 我们这边的话就直接

40:31.650 --> 40:32.650
直接reget

40:35.340 --> 40:38.380
对吧 好的 接下来如果进这个ls

40:39.180 --> 40:46.860
进ls的话 说明是不是ok的 对不对 说明这边ok ok的话 那这里的话 我们就把这个信息

40:47.100 --> 40:47.860
放到藏口

40:48.580 --> 40:49.340
说明

40:51.140 --> 40:55.500
说明这个token是ok的

40:58.820 --> 41:02.020
ok的话 那我们这边就干嘛呢 将用户信息

41:05.120 --> 41:06.280
放入到

41:07.040 --> 41:07.560
藏库

41:08.320 --> 41:10.120
对吧 那这边的话就是commit

41:12.640 --> 41:17.240
commit 然后这边之前定义好的这个sator user

41:18.800 --> 41:19.760
把他放到这

41:20.840 --> 41:21.600
sator

41:24.720 --> 41:29.720
然后这里 这里的话啊 这样子 我先给大家看一下他这个返回的这个东西吧

41:30.240 --> 41:34.000
返回的东西长什么样子 我们先看一下 这边啊log

41:34.640 --> 41:35.960
然后res

41:38.280 --> 41:46.240
然后这里 res ok 我们先来看一下啊 看一下这边get info 拿到的这个东西是什么 我们把它全部保存

41:50.300 --> 41:53.420
好 保存了之后 然后接下来的话 我们看一下我看一下这有没有错啊

41:56.350 --> 41:59.030
好 没问题 没问题 之后大家回到我们这边

42:01.290 --> 42:02.290
把这里打开

42:08.460 --> 42:13.220
这里打开好 打开之后 然后这样我们这边我们来看一下and me 然后

42:14.260 --> 42:19.900
6 4 3 2 1 然后接下来这边3g x1好 这边点击登录

42:20.860 --> 42:22.980
点击登录之后 然后接下来他这边

42:24.100 --> 42:28.140
呃 没有过去是吧 没有过去 我们这边我们来看一下 这边是怎么回事

42:30.180 --> 42:33.380
好 我们这边来看一下 这边的话 首先我们来检查这个views

42:34.380 --> 42:37.780
views里面的话 我们先看一下这个用户信息啊

42:39.220 --> 42:43.700
用户信息user 然后user是不是已经有东西了 然后接下来的话 这里

42:45.810 --> 42:51.290
这里的话这个这个是不是也有了 这个也有了的话 那他就应该是进入到

42:51.970 --> 42:58.130
我们来看一下啊 这边 现在要去的页面是需要全线验证的 让我们来看一下 只要我们来看一下这个东西有没有拿到

42:58.450 --> 43:04.980
就是这个 hasget user info 我们这边log一下 hasget

43:06.580 --> 43:11.280
user info 好 保存

43:13.600 --> 43:20.700
好 大家这边我们来看一下这个东西有没有拿到 这边的话 我们重新登录一下

43:21.420 --> 43:26.540
654321 然后接下来这边mg q2

43:27.340 --> 43:29.700
走 好 这个信息是不是拿到了的

43:30.780 --> 43:37.300
对不对 这边是拿到了 拿到了的话 他这边的话就应该是进啊 这边这边是没写啊

43:38.100 --> 43:40.700
对不对 这里没写啊 你这边那就是直接放行

43:41.700 --> 43:44.060
那就应该是next

43:45.460 --> 43:50.340
是吧 好 大家再保存一下啊 这次应该就ok了啊 这边我们重新来

43:52.180 --> 43:58.220
and me 然后接下来的话 这里654321 然后接下来这边的话

43:59.220 --> 43:59.500
6

44:00.500 --> 44:02.660
r y k4 走

44:03.740 --> 44:09.820
进来了 进来了之后 然后接下来的话 我们这边 我想想怎么让他进到这一步

44:10.540 --> 44:11.900
他现在有talking

44:12.900 --> 44:20.940
啊 怎么进到这一步 我把他本地的那个数据把它删掉就可以了 删掉他是不是就会进这一步啊 进这一步之后 然后接下来他这边是不是就会去

44:21.700 --> 44:27.820
dispatch user get in fire 对吧 好 那接下来我们这边 我把这个用户数据 我把它删掉

44:29.340 --> 44:29.900
现在这边

44:30.620 --> 44:34.780
呃 user 这边是不是有东西啊 对吧 我把这个东西我把它删掉

44:35.540 --> 44:37.100
啊 删掉之后 大家我们这边我们走

44:37.820 --> 44:45.620
删掉之后 我把这清空啊 随便走一个有走 你看现在呢 是不是会去拿这个东西啊

44:46.780 --> 44:52.660
对不对 他这边的话就是走走到哪呢啊 走到这里了dispatch 然后接下来的话 user infer

44:53.300 --> 44:55.180
是不是会把你的本地的这个talking

44:55.860 --> 45:00.860
发送到这个服务器 那服务器对这个talking进行一个解析验证

45:01.460 --> 45:03.620
好 解析验证之后 然后接下来回到我们这边

45:04.580 --> 45:09.780
回到我们这边 这边验证的话是不是会分两种情况 一种是什么呢 一种就是像这样子

45:10.940 --> 45:17.660
一种就是像这个样子 就是你的这个talking是有效的 有效的话我返回的是这样子的数据 对不对 其实就是这边

45:18.540 --> 45:25.340
其实就是这边 返回的是不是这样的数据 对不对 那还有种情况就是你的talking已经过去 这个过期了

45:26.140 --> 45:29.660
我怎么让这个talking过期呢 那很简单 我这边是不是手中改一下

45:30.380 --> 45:33.660
对不对 我比如说这边 第一个字母是e 我给他改成一个a

45:35.180 --> 45:40.340
对吧 那你现在的talking肯定是有问题的吗 解析是不成功的 不成功的话 大家我这边我再走

45:40.940 --> 45:47.660
你看 这边的话拿到了就是一个什么 拿到了是不是就是这样子的一个这个制服串呀 你注意这个是制服串哦

45:48.180 --> 45:56.300
这个是对象 就对象和制服串你还是能够分的分面的出来的 对不对 这个一看就是个制服串 这个是一个对象 对不对 好 那现在我们把这个

45:57.180 --> 46:00.340
把这个我们把它复制过来 就是有可能是这种情况

46:01.820 --> 46:04.460
啊 你注意哈 就是有可能是这种情况

46:05.340 --> 46:08.860
它是一个什么呢 它是一个这个stream 这个是不过的情况

46:10.580 --> 46:13.740
不过的情况 就验证应该说验证失败嘛

46:15.060 --> 46:21.060
验证失败的情况 那也有可能是哪种情况呢 也有可能是这种情况

46:22.260 --> 46:22.900
就这种情况

46:23.900 --> 46:26.700
这种情况其实就是这边 是不是这种情况

46:27.620 --> 46:32.460
反回的是这个 对吧 反回的是这个的话 说明是什么呢 说明是验证成功

46:33.500 --> 46:34.020
把这个

46:35.060 --> 46:35.700
把它注释掉

46:39.940 --> 46:40.900
就有可能是这种情况

46:42.220 --> 46:43.660
这个是验证成功的情况

46:45.460 --> 46:45.940
验证

46:47.060 --> 46:47.500
成功

46:48.860 --> 46:49.260
的情况

46:50.220 --> 46:57.300
ok 那现在的话 失败和成功你就都知道了啊 那我们这边的话 我们就可以开始来写代码了 那接下来把这个下面的这个打开

46:58.340 --> 47:05.420
把这个打开 那我们先写这个又是吗 那如果这边呢验证成功 验证成功之后 然后接下来他反回的是一个什么

47:05.860 --> 47:07.380
反回的是不是一个这个对象

47:08.580 --> 47:13.540
对吧 是一个这个对象 对象的话 这边re是 然后接下来这边是不是就是应该是点

47:14.380 --> 47:14.620
点它

47:15.620 --> 47:19.780
是不是像这样子啊 然后接下来干嘛呢 然后接下来resolve

47:21.500 --> 47:25.380
啊resolve 然后接下来这边这边的话就是你如果是这个stream

47:25.980 --> 47:33.140
stream的话就说明你这边是不是有问题 有问题的话我这边我可以这个样子 我先把它转成这个对象

47:34.380 --> 47:35.140
res

47:36.180 --> 47:37.740
等于一个这个json

47:38.500 --> 47:39.340
点parse

47:41.020 --> 47:41.580
res

47:42.580 --> 47:48.900
那你这一块 这一块我是不是就把它转成这个对象了 对不对 转成对象之后我这边我可以再严谨一点

47:49.340 --> 47:56.780
怎么严谨呢 因为你反过 反回回来的这个状态吗 有可能不是401 有可能是其他的 对吧 我这边让我就再判断一下

47:57.140 --> 47:57.620
e4

47:58.500 --> 48:04.220
二也是点这个code 如果它等于一个什么呢 等于一个这个401

48:06.340 --> 48:09.100
让我这边就干嘛呢 我这边的话就是reject

48:12.860 --> 48:23.320
啊reject 这里 我这边就reject 然后再把什么拿过去 这就是res

48:24.200 --> 48:25.440
点这个msg

48:27.040 --> 48:35.480
对不对 把这个东西返回 好了 接下来这一步 这个地方我们就改完了 改完了之后然后回到我们这个

48:36.000 --> 48:39.000
拍发action的地方 拍发action我们是在哪 拍发的

48:40.600 --> 48:41.080
是在

48:41.080 --> 48:42.280
在

48:43.240 --> 48:48.240
是在permission里面 是吧 permission好 这个位置啊 它代码的话 是不是就会回到这里啊

48:49.800 --> 48:58.360
好 回到这里 回到这里的话 它这里的话就会啊 你如果reject reject的话在这边啊 补货到补货到这这里的话 告诉你 是不是登录过接

48:58.800 --> 49:04.440
请重新登录啊 我们来看吧 整个流程吧 跑通一遍啊 我这边的话全部保存

49:05.880 --> 49:07.880
保存之后在家 我们这边重新来跑一遍

49:08.880 --> 49:09.880
这里

49:11.160 --> 49:18.640
这里的话 现在是已经 你看 是不是已经这里回过来了啊 告诉你这个登录已经过期了啊 只不过这里的话 它报了一个错

49:19.520 --> 49:23.320
报这个错是我们下面还没有改啊 对了 我把下面我把它改一下

49:24.560 --> 49:26.280
在哪个位置呢 这个位置

49:26.960 --> 49:32.640
这个位置是不是就是user reset token 那接下我们找到这个user reset token

49:33.520 --> 49:42.700
在这个位置 这个位置 然后这个get info我们就写了啊 这个的话是恢复登录状态 恢复

49:43.740 --> 49:44.260
登录

49:45.780 --> 49:47.180
状态啊 我们找到这边

49:48.300 --> 49:50.460
找到这边 这边的话是不是就是recept

49:51.140 --> 49:54.340
recept token 好 那接下来的话 它这边的话报的是什么

49:55.860 --> 49:56.460
报的是

49:57.460 --> 50:03.060
这个没找到 是吧 我们来看一下这里 这里的话 它是commit了一个reset state

50:03.140 --> 50:05.660
reset state 好像被我们注释掉了

50:06.700 --> 50:09.780
在这个位置啊 我们是把它注释掉了 好 我们把这个打开

50:11.260 --> 50:11.860
把这个打开

50:13.780 --> 50:15.500
打开之后 让我们这边保存一下

50:16.660 --> 50:20.580
啊 ok了 这边就ok了 好 我们这边再完成走一遍

50:21.100 --> 50:26.020
and me 然后接下来这边6 4 3 2 1 好 大家这边

50:26.620 --> 50:29.980
啊 a k p j 好 大家这边登录

50:31.100 --> 50:35.260
登录是不是跳过来 对不对 这个这个是因为我看呀 这个gator

50:35.740 --> 50:42.780
就因为我们刚才注释了一些啊 这个的话回头我们把它删了就可以了啊 我们先先看这边流程 这边的话你现在的话走任意的一个

50:43.980 --> 50:44.660
是不是ok的

50:45.420 --> 50:49.380
对不对 走任意的一个是ok的 好像这样我这边我强行要跳到这个logging去

50:51.780 --> 50:53.500
走 是不是回到首页

50:54.340 --> 51:00.340
对不对 那回到首页之后 然后接下来换我这边 比如说我这边是blog least 是吧 好像这样我再退出状态

51:01.900 --> 51:05.060
我现在退出我们是吧 还没做好 我们把这个退出我们把它做了

51:05.660 --> 51:08.660
把退出做了 退出其实很简单 退出的话你先找到这

51:09.380 --> 51:14.140
先要把这一块先把它找到啊 这一块对应的是哪里呢 我们来找一下

51:15.980 --> 51:21.220
好 这里这里的话 我们来看一下他的这个抱错 抱错的话他这边的话你看 他是不是他都提示我了

51:21.660 --> 51:26.980
是不是layoutcomponent下面的这个level bar 对不对 那接下来你回到这边来找呗

51:28.100 --> 51:30.340
好 这边让我把这些该关了 先关一下

51:31.220 --> 51:37.740
好吧 折起来 折起来之后再加你找呗 在这下面是不是会有一个component啊 应该是layout下面

51:38.500 --> 51:46.780
layout这边 下面是不是有一个这个component啊 component下面是不是有一个level bar 对不对 level bar里面 你看这边

51:47.780 --> 51:51.900
是不是对应了呀 和和这边是不是就对上了 你把这个展开

51:52.940 --> 51:54.020
home get a hub

51:54.580 --> 52:01.660
dux log out 这就对上了 对上了的话 我们现在我们这边的话我们只要什么的 我们这边我这边是登录

52:02.220 --> 52:08.100
退出去了 这边我们只要两个一个是个人信息一个是这个退出登录 所以我们把这个的话我们把它清除一下

52:09.460 --> 52:11.340
我们这边把它清空一下啊

52:12.340 --> 52:13.540
这里的话我们就

52:14.780 --> 52:16.780
这个这个的话我们是个人中心

52:18.100 --> 52:20.220
个人中心

52:22.380 --> 52:26.740
然后其他的话我们就不要了 这些的话就都不要了

52:27.900 --> 52:28.940
啊 这些的话都把它干掉

52:30.020 --> 52:36.910
好 干掉之后人家这边这边的话就是一个什么呢 就是一个退出登录 退出

52:37.950 --> 52:42.870
登录 退出登录的话我们看一下 他这边是否绑了一个这个事件 叫做这个locking out

52:43.350 --> 52:49.430
那你下去去找找这个logging out log out是不是对呢 是这一块 对不对 那这一块

52:50.550 --> 52:53.390
这一块的话我们是不需要去改的

52:54.990 --> 52:58.990
啊 不需要去改 但是你看他这边 这边呢 他是不是dispatch了一个user login

52:59.510 --> 53:06.150
说你需要去看这个user login啊logging out啊log out log out 我们这边需要去看这个log out

53:06.750 --> 53:12.230
回到你的这个store 这边 store下面的user log out

53:12.950 --> 53:15.990
我们来找log out在

53:17.350 --> 53:23.790
log out这个位置 是不是在这个位置啊 对不对 我们在这个位置的话 然后既然这部分代码我们是不要就要进行修改了

53:24.550 --> 53:27.390
啊 那既然这部分代码修改成什么样子呢 我们来看一下

53:29.070 --> 53:36.910
这部分代码的话他是调了一个这个叫做logging out 我们这边又去追哈 你要一定要这个这个阶段 大家一定要去学会追原码了

53:37.270 --> 53:43.550
你又去追 然后既然他这边是不是调了一个这个log out 那既然你看这个log out log out对呢 是不是这一块

53:44.550 --> 53:51.190
对不对 他这个退出登录的这个方法 那接下来我们这边的话 我们来看一下 我们有没有这个退出登录的这个API

53:52.190 --> 53:57.470
是没有 我们这边就是三个 一个是这个登录啊logging 一个是这个更新

53:57.950 --> 54:01.950
更新是后面做了一个个人信息的时候会用的 一个是这个互mi

54:02.430 --> 54:07.550
这个呢 是这个恢复 登录状态的 啊 说说我们这边的话 我们就不需要调这个方法

54:08.710 --> 54:11.630
回到这边 这边呢 我们就不需要调这个 我们把这个给他注释掉

54:12.710 --> 54:17.310
那我们这边要做的什么事情呢 我们要做的其实就是这三件事情啊 把这个给他拿出来

54:19.470 --> 54:20.390
把这个给他拿出来

54:21.590 --> 54:28.230
啊 事件事情 做的就是这四件事情 格式化一下 首先是不remove token 那接下来reset

54:29.230 --> 54:34.150
reset这个router 那接下commit reset state 那接下来resolve

54:35.070 --> 54:38.190
那么来看一下remove token remove token对应的是哪个呢

54:38.950 --> 54:46.230
remove token对应的是这个啊 调用这个方法 这个其实你也不用 我们这边要把本地的这个token 把它删掉就可以了

54:46.470 --> 54:50.510
所以我们这边的话 我们这边怎么改造一下呢 我们在这个位置

54:51.190 --> 54:52.430
这个位置 我们把这改造一下

54:53.430 --> 55:01.510
那调这个方法 调这个方法的话 我们把它注释掉 调这个方法的话 我们在这个地方 我们就直接local storage

55:02.590 --> 55:07.070
local storage点什么呢 这边有一个叫做remove item

55:08.510 --> 55:17.240
对不对 然后我们把这个and main token 我们把它删除掉 然后回到这边

55:18.680 --> 55:23.440
回到这边 然后接下来这边是resetrouter 这个的话不用去管他

55:24.400 --> 55:29.840
这个不用去管他 这个是他之前写好了的 一个重置这个路由的 对吧 我们就用他这个

55:30.200 --> 55:35.160
好 然后接下来的话 这边有一个commit reset state 那你需要看一下你的reset state

55:35.680 --> 55:40.800
有没有 是有 刚刚我们注释打开了的 是吧 然后最后一个 最后一个就是resolve

55:41.360 --> 55:45.160
ok 那我们的这个退出功能就做好了 我们这边呢 全部保存一下

55:46.840 --> 55:47.440
全部保存

55:49.400 --> 55:51.240
保存之后 然后接下来这边过来看一下

55:51.720 --> 56:00.560
过来看一下 好了 现在的话 我这边的话 我点击啊 你看这边是不是已经变了 个人中心退出登诺 然后将我点击点击这个退出登诺

56:01.440 --> 56:06.120
是不是现在就退出了 好 我们把这个整个这个流程把它过一遍啊 首先的话 这边

56:06.880 --> 56:12.200
and main 然后6 5 4 3 2 1 然后接下来这边输入这个验证吗

56:12.880 --> 56:16.960
h h tg 啊 然后加轴

56:17.720 --> 56:22.080
是不是登录进来 啊 下面这个错你先不管了啊 这个的话是那个头像那个

56:22.480 --> 56:28.960
那个的话就是因为我们有些东西注释掉了 所以他这边找不到 好的 接下来这边过来 过来的话 既然我这边我要去logging

56:30.240 --> 56:31.320
我现在是属于什么

56:32.320 --> 56:36.520
啊 你脑袋里过一下 脑袋里过一下 我现在是属于什么 我现在是不是属于这里

56:37.200 --> 56:43.400
对不对 这里的话我是已经登录的情况下 我要去这个logging 那既然他会跟我导航到哪里 这不导航到首页

56:44.040 --> 56:46.040
对不对 那既然我们这边导航到首页 走

56:48.470 --> 56:54.230
是我给我导航到首页 对不对 好那接下来下面 下面的话去去那个其他页面都是ok的

56:54.990 --> 56:57.990
没有问题 好那现在我们做一件事情 我们把这个token

56:59.350 --> 57:00.190
我们把它改一下

57:01.590 --> 57:02.270
这边来到这里

57:03.470 --> 57:04.030
我们来改一下

57:05.510 --> 57:09.030
改一下之后 然后接下来的话 现在这个token是不是有问题了

57:09.790 --> 57:13.150
对不对 有问题的话 现在你切换的话 你是能够正常切换

57:13.830 --> 57:19.350
为什么呢 因为你的那个仓库里面 是不是 是有东西的 对不对 你这边的话 你把这个仓库

57:20.270 --> 57:21.190
把那个user

57:23.360 --> 57:27.000
把那个user user 这边是不是有东西 对不对 那你把这个user 你把它清空掉

57:27.720 --> 57:31.520
清空掉的话 他这个这个views 免得什么没有东西 那接下来我们这边走

57:32.600 --> 57:35.560
看到没有 他这边是不是就是登录过期 请重新进行登录

57:36.400 --> 57:40.440
看到没有 那我们整个这个健全的这个流程的话 我们就走完了

57:41.000 --> 57:44.120
啊 整个就走完了 那我们整个这个登录功能的话

57:44.560 --> 57:50.680
也就做完了 你现在的话要强行过去 你是过不去的 比如我这边的话来一个这个blog list

57:51.960 --> 57:58.680
blog list 走 你看你是不是过不去 对不对 你是过不去的啊 整个这个健全就走完了哈

57:59.120 --> 58:03.720
大家下去的话一定要把这个健全这个好好理解一下 配合着这个吗

58:04.520 --> 58:05.320
配合着这张图

58:06.840 --> 58:10.480
明白没有 配合着这张图 然后接下来结合着我们这边的这个代码

58:10.960 --> 58:17.600
虽然这个今天这个代码有点多 然后一会儿就是改这一会儿就改那 但是你一定要学会就是去追这个代码

58:18.280 --> 58:24.640
去追这个圆码 一定要就是一步一步去追 我这边的话 我们既然在用一个框架 我们这边的话

58:25.040 --> 58:31.320
就是快速开发的话 我们这边有些就是在他的基础上 稍做这个改造 然后用到了一个看那个

58:31.760 --> 58:34.960
啊 不是说我要把整个框架 我先把它弄熟了

58:35.680 --> 58:40.960
每一个知识点都弄熟了 我才能进行开发 你真是就是工作的时候不是这个样子的

58:41.760 --> 58:43.320
你工作的时候是赶时间的

58:44.200 --> 58:49.760
知道吧 说快速 你要快速上手一个框架 有可能你一个星期你会接触好几个框架

58:50.600 --> 58:51.520
这个都是很正常的

58:52.360 --> 58:58.360
明白没有啊 好 下去的话 把这个健全的话 把这个做一下啊 这节课就先到这里

